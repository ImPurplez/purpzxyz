<!DOCTYPE html>
<head>
    <title>Hip to be Squared</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech&display=swap" rel="stylesheet">
    
</head>
<body>
    <style>
        body {
            color: #000000;
            margin: auto;
            height: 100%;
            overflow: hidden;
            cursor: none;
        }
        .share-tech-regular {
            font-family: "Share Tech", sans-serif;
            font-weight: 400;
            font-style: normal;
        }
    </style>
    <canvas oncontextmenu="return false;" onmousemove="xy(event)" width="1990px" height="1020px" id="gameScreen"></canvas>
    <p id="fps">60</p>
    <script>
        //canvas or gamescreen
        var canvas = document.getElementById("gameScreen");
        //context, for drawing
        var ctx = canvas.getContext("2d");
        //settings canvas size and scale
        var screenScale = window.innerWidth/canvas.width
        if (window.innerHeight/canvas.height < screenScale) screenScale = window.innerHeight/canvas.height;

        ctx.translate((window.innerWidth-canvas.width*screenScale)/2, (window.innerHeight-canvas.height*screenScale)/2);

        ctx.scale(screenScale, screenScale);

        //detect keypresses
        var keys = [];
        window.addEventListener('keydown', function (e) {
            if (!keys.includes(e.key.toLowerCase())) keys.push(e.key.toLowerCase());
            if (e.key == "Escape" && !game.upgrading) {
                game.playing = !game.playing;
                game.menu = "pause";
            }
            //if (e.key == "r") enemys = [];
        }, false);
        window.addEventListener('keyup', function (e) {
            while (keys.includes(e.key.toLowerCase())) {
                keys.splice(keys.indexOf(e.key.toLowerCase()), 1);
            }
        }, false);
        window.addEventListener('mousedown', function () {
            keys.push("mouse");

            if (game.upgrading) {
                if (mouseX >= canvas.width/2+250 && mouseX <= canvas.width/2+450 && mouseY >= 60 && mouseY <= 120) {
                    upgrade();
                } else if (mouseY < 375 && mouseY > 150) {
                    if (upgradesAvailable.length > 2) {    
                        if (mouseX < canvas.width/3) game.select = 0;
                        else if (mouseX > canvas.width/3*2) game.select = 2;
                        else game.select = 1;
                    } else if (upgradesAvailable.length > 1) {   
                        if (mouseX < canvas.width/2) game.select = 0;
                        else game.select = 1;
                    } else select = 0;
                }
            }

            if (!game.playing && !game.upgrading) {
                if (game.subMenu == "options") {
                    if (mouseX > canvas.width/2-125 && mouseX < canvas.width/2+125 &&
                        mouseY > canvas.height/2-300 && mouseY < canvas.height/2-225
                    ) {
                        game.subMenu = false;
                    } else if (mouseX > canvas.width/2-125 && mouseX < canvas.width/2+125 &&
                        mouseY > canvas.height/2-200 && mouseY < canvas.height/2-125
                    ) {
                        game.motionBlur = !game.motionBlur;

                        localStorage.setItem("motionBlur", JSON.stringify(game.motionBlur))
                    } else if (mouseX > canvas.width/2-125 && mouseX < canvas.width/2+125 &&
                        mouseY > canvas.height/2-100 && mouseY < canvas.height/2-25
                    ) {
                        game.displayFps = !game.displayFps;

                        localStorage.setItem("displayFps", JSON.stringify(game.displayFps))
                    } else if (mouseX > canvas.width/2-125 && mouseX < canvas.width/2+125 &&
                        mouseY > canvas.height/2-0 && mouseY < canvas.height/2+75
                    ) {
                        game.displayWaveNum = !game.displayWaveNum;

                        localStorage.setItem("displayWaveNum", JSON.stringify(game.displayWaveNum))
                    } else if (mouseX > canvas.width/2-125 && mouseX < canvas.width/2+125 &&
                        mouseY > canvas.height/2+100 && mouseY < canvas.height/2+175
                    ) {
                        game.displayDmgNum = !game.displayDmgNum;

                        localStorage.setItem("displayDmgNum", JSON.stringify(game.displayDmgNum))
                    }
                } 
                else if (game.menu == "main") {if (mouseX > canvas.width/2-125 && mouseX < canvas.width/2+125 &&
                        mouseY > canvas.height/2-300 && mouseY < canvas.height/2-225
                    ) {
                        game.playing = true;
                        spawnWave();
                    } else if (mouseX > canvas.width/2-125 && mouseX < canvas.width/2+125 &&
                        mouseY > canvas.height/2-200 && mouseY < canvas.height/2-125
                    ) {
                        game.subMenu = "options";
                    }
                } 
                else if (game.menu == "pause") {
                    if (mouseX > canvas.width/2-125 && mouseX < canvas.width/2+125 &&
                        mouseY > canvas.height/2-300 && mouseY < canvas.height/2-225
                    ) game.playing = true;
                    else if (mouseX > canvas.width/2-125 && mouseX < canvas.width/2+125 &&
                        mouseY > canvas.height/2-200 && mouseY < canvas.height/2-125
                    ) {
                        game.subMenu = "options";
                    }
                } else if (game.menu == "death") {
                    if (mouseX > canvas.width/2-125 && mouseX < canvas.width/2+125 &&
                        mouseY > canvas.height/2-300 && mouseY < canvas.height/2-225 ) {
                        window.location.reload();
                    } else if (mouseX > canvas.width/2-125 && mouseX < canvas.width/2+125 &&
                        mouseY > canvas.height/2-200 && mouseY < canvas.height/2-125 && player.health > 0
                    ) {
                        game.playing = true;
                    }
                }   
            }
        }, false);
        window.addEventListener('mouseup', function () {
            while (keys.includes("mouse")) {
                keys.splice(keys.indexOf("mouse"), 1);
            }
        }, false);
        //mouse position
        var mouseX = 0;
        var mouseY = 0;
        function xy(e) {
            mouseX = e.x/screenScale - (window.innerWidth-canvas.width*screenScale)/2/screenScale;
            mouseY = e.y/screenScale - (window.innerHeight-canvas.height*screenScale)/2/screenScale;
        }
        var filterStrength = 10; //used  to be 20
        var frameTime = 0, lastLoop = new Date, thisLoop;

        // Report the fps only every second, to only lightly affect measurements
        var fpsOut = document.getElementById('fps');
        setInterval(function(){
            fpsOut.innerHTML = (1000/frameTime).toFixed(1);
            game.fps = Number(fpsOut.innerHTML);
        },1000);

        let bullets = [];
        let bulletBuffer = [];
        let enemys = [];
        let enemyBuffer = [];

        var pickups = [];
        
        var waveNum = -1;

        const allUpgrades = [
/*MC*/      {
                name: "Metal Coil",
                subText: "",
                description: ["20% Chance for bullets to spawn","with 145% damage & size"],
                upgradeFunction() {
                    baseStats.metalCoil = {
                        critChance: 0.20,
                        critScaling: 1.45
                    };
                },

                children: [
                    {
                        name: "Metal Coil+",
                        subText: "Thicker Wire",
                        description: ["Metal Coils effect", "boosted to 195%"],
                        upgradeFunction() {
                            baseStats.metalCoil.critScaling = 1.95;
                        },

                        children: [
                            {
                                name: "Metal Coil+",
                                subText: "Thickest Wire",
                                description: ["10% chance for", "250% effect"],
                                upgradeFunction() {
                                    baseStats.metalCoil.pCritChance = 0.65;
                                    baseStats.metalCoil.pCritScaling = 2.5;
                                }
                            },
                        ],
                    },{
                        name: "Metal Coil+",
                        subText: "Longer Spring",
                        description: ["35% effect chance"],
                        upgradeFunction() {
                            baseStats.metalCoil.critChance = 0.35;
                        },

                        children: [
                            {
                                name: "Metal Coil+",
                                subText: "Longest Spring",
                                description: ["55% effect chance"],
                                upgradeFunction() {
                                    baseStats.metalCoil.critChance = 0.55;
                                }
                            },
                        ],
                    },
                ],
            },
/*CS*/      {
                name: "Cell Splitter",
                subText: "",
                description: ["+2 Projectiles","-35% bullet damage", "-20% bullet size"],
                upgradeFunction() {
                    statMult.projectiles += 2;
                    statMult.damage *= 0.65;
                    statMult.bulletSize *= 0.8;
                },

                children: [
                    {
                        name: "Cell Splitter+",
                        subText: "Concentrism",
                        description: ["Concentrates projectiles", "by 60%"],
                        upgradeFunction() {
                            statMult.spread *= 0.4;
                        },
                                
                        children: [
                            {
                                name: "Cell Splitter+",
                                subText: "Convergence",
                                description: ["+1 Projectile","-50% Spread"],
                                upgradeFunction() {
                                    statMult.projectiles += 1;
                                    statMult.spread *= 0.5;
                                }
                            },{
                                name: "Cell Splitter+",
                                subText: "Spreadth",
                                description: ["+2 Projectile","+50% Spread"],
                                upgradeFunction() {
                                    statMult.projectiles += 2;
                                    statMult.spread *= 1.5;
                                },
                            }
                        ], 
                    },{
                        name: "Cell Splitter+",
                        subText: "Extra",
                        description: ["+1 Projectile", "-10% damage"],
                        upgradeFunction() {
                            statMult.projectiles += 1;
                            statMult.damage *= 0.9;
                        },
                        
                        children: [
                            {
                                name: "Cell Splitter+",
                                subText: "Fullsade",
                                description: ["Double Base Projectiles", "+1 Projectile", "-30% Bullet damage & size"],
                                upgradeFunction() {
                                    statMult.projectiles += baseStats.projectiles+1;
                                    statMult.damage *= 0.7;
                                    statMult.bulletSize *= 0.7;
                                }  
                            },
                        ],
                    },
                ],
            },
/*BS*/      {
                name: "Bloody Scythe",
                subText: "",
                description: ["Enemys take bleed damage","0.5 damage every one third second", "Cap of 3 stacks"],
                upgradeFunction() {
                    baseStats.bloodyScythe = {
                        damage: 0.5,
                        tickRate: 3,
                        cap: 3
                    };
                },

                children: [
                    {
                        name: "Bloody Scythe+",
                        subText: "Deeper Cut",
                        description: ["+2 stack cap"],
                        upgradeFunction() {
                            baseStats.bloodyScythe.cap += 2;
                        },

                        children: [
                            {
                                name: "Bloody Scythe+",
                                subText: "Deepest Cut",
                                description: ["+5 stack cap"],
                                upgradeFunction() {
                                    baseStats.bloodyScythe.cap += 5;

                                }
                            },
                        ],
                    },{
                        name: "Bloody Scythe+",
                        subText: "Flow",
                        description: ["+50% damage"],
                        upgradeFunction() {
                            baseStats.bloodyScythe.damage *= 1.5;
                        },

                        children: [
                            {
                                name: "Bloody Scythe+",
                                subText: "OverFlow",
                                description: ["+100% Tickrate"],
                                upgradeFunction() {
                                    baseStats.bloodyScythe.tickRate *= 2;
                                }
                            },
                        ],
                    },
                ],
            },
/*AI*/      {
                name: "After Images",
                subText: "",
                description: ["+50% FireRate","-10% bullet damage"],
                upgradeFunction() {
                    statMult.fireRate /= 1.5;
                    statMult.damage *= 0.9;
                },
                children: [
                    {
                        name: "After Images+",
                        subText: "Double Tap",
                        description: ["+1 Burst", "-75% accuracy"],
                        upgradeFunction() {
                            statMult.bursts += 1;
                            statMult.bloom *= 1.75;
                        },
                        children: [
                            {
                                name: "After Images+",
                                subText: "Burst",
                                description: ["+3 Burst", "+20% accuracy", "-45% fire rate"],
                                upgradeFunction() {
                                    statMult.bursts += 3;
                                    statMult.bloom *= 0.8;
                                    statMult.fireRate /= 0.55;
                                }
                            },
                        ],
                    },{
                        name: "After Images+",
                        subText: "Lighter Rounds",
                        description: ["+30% Fire Rate", "+50% accuracy", "-5% damage"],
                        upgradeFunction() {
                            statMult.fireRate /= 1.3;
                            statMult.bloom *= 0.5;
                            statMult.damage *= 0.95;
                        },
                        children: [
                            {
                                name: "After Images+",
                                subText: "Spray and Pray",
                                description: ["+100% Fire Rate", "-150% accuracy"],
                                upgradeFunction() {
                                    statMult.fireRate /= 2;
                                    statMult.bloom *= 2.5;
                                }
                            },
                        ],
                    },
                ],
            },
/*HT*/      {
                name: "Health Tracker",
                subText: "",
                description: ["high chance for a","heatlh pickup on", "each enemy death"],
                upgradeFunction() {
                    baseStats.pickupChance = 0.7;
                },

                children: [
                    {
                        name: "Health Tracker+",
                        subText: "Un-Capped",
                        description: ["+60% Max Health"],
                        upgradeFunction() {
                            statMult.healthMax *= 1.6;
                            player.health *= 1.6;
                        }
                    },{
                        name: "Health Tracker+",
                        subText: "Micro-Healers",
                        description: ["+100% Chance for health pickup"],
                        upgradeFunction() {
                            statMult.pickupChance *= 1.9;
                        }
                    },
                ],
            },
/*SB*/      {
                name: "Smooth Barrel",
                subText: "",
                description: ["+45% Bullet Damage","and bullet velocity"],
                upgradeFunction() {
                    statMult.damage *= 1.45;
                    statMult.bulletSpeed *= 1.45;
                },

                children: [
                    {
                        name: "Smooth Barrel+",
                        subText: "Aerodynamics",
                        description: ["+60% Bullet Speed"],
                        upgradeFunction() {
                            statMult.bulletSpeed *= 1.6;
                        },

                        children: [
                            {
                                name: "Smooth Barrel+",
                                subText: "Far Shot",
                                description: ["Bullets Deal more damage", "the further they travel", "+20% Bullet Speed"],
                                upgradeFunction() {
                                    statMult.bulletSpeed *= 1.2;
                                    if (baseStats.dmgPerDist) baseStats.dmgPerDist *= 2;
                                    else baseStats.dmgPerDist = 0.02;
                                }
                            }
                        ]
                    },{
                        name: "Smooth Barrel+",
                        subText: "Damage",
                        description: ["+60% Bullet Damage"],
                        upgradeFunction() {
                            statMult.damage *= 1.6;
                        }
                    },
                ],
            },
/*PR*/      {
                name: "Piercing Rounds",
                subText: "",
                description: ["+5% Bullet Damage","+1 Pierce"],
                upgradeFunction() {
                    statMult.damage *= 1.05;
                    statMult.pierce += 1;
                },

                children: [
                    {
                        name: "Piercing Rounds+",
                        subText: "Sharper Point",
                        description: ["+1 Pierce"],
                        upgradeFunction() {
                            statMult.pierce += 1;
                        },

                        children: [
                            {
                                name: "Piercing Rounds+",
                                subText: "Pointy Rounds",
                                description: ["+20% Damage", "+2 Pierce"],
                                upgradeFunction() {
                                    statMult.damage *= 1.2;
                                    statMult.pierce += 2;
                                }
                            }
                        ]
                    },{
                        name: "Piercing Rounds+",
                        subText: "Bloody Rounds",
                        description: ["+20% Damage", "per pierce", "+20% Bullet Speed"],
                        upgradeFunction() {
                            baseStats.dmgPerPierce = 1.2;
                            statMult.bulletSpeed *= 1.2
                        },
                        children: [
                            {
                                name: "Piercing Rounds+",
                                subText: "Crimson",
                                description: ["+50% Damage", "per pierce"],
                                upgradeFunction() {
                                    baseStats.dmgPerPierce *= 1.5;
                                }
                            }
                        ]
                    },
                ],
            },
        ];
        const singletonUpgrades = [
/*BC*/      {
                name: "Big Cheese",
                subText: "Singleton",
                description: ["+20% Bullet Damage & Size","-20% Firerate"],
                upgradeFunction() {
                    statMult.damage *= 1.2;
                    statMult.bulletSize *= 1.2;
                    statMult.fireRate /= 0.8;

                    children = false;
                },
            },
/*TB*/      {
                name: "Tight Boots",
                subText: "Singleton",
                description: ["+20% Player speed","+10% Bullet Speed"],
                upgradeFunction() {
                    statMult.speed *= 1.2;
                    statMult.maxSpeed *= 1.2;
                    statMult.bulletSpeed *= 1.1;

                    children = false;
                },
            },
/*ED*/      {
                name: "Energy Drink",
                subText: "Singleton",
                description: ["+10% Fire rate"],
                upgradeFunction() {
                    statMult.fireRate /= 1.1;

                    children = false;
                },
            },
/*HS*/      {
                name: "Healing Sign",
                subText: "Singleton",
                description: ["Sets health to max"],
                upgradeFunction() {
                    player.health = baseStats.healthMax*statMult.healthMax;

                    children = false;
                },
            },
        ];

        allUpgrades.push(...singletonUpgrades);

        const allWeapons = [
/*GG*/      {
                name: "Gatling Gun",
                subText: "",
                description: ["High fire rate","low damage"],
                upgradeFunction() {
                    baseStats.fireRate = 0.08;
                    baseStats.damage = 0.75;
                    baseStats.bloom = Math.PI/6;
                },
                children: [                    {
                        name: "Gatling Gun+",
                        subText: "Faster Barrel Spin",
                        description: ["+25% Fire Rate"],
                        upgradeFunction() {
                            baseStats.fireRate /= 1.25;
                        }
                    },{
                        name: "Gatling Gun+",
                        subText: "Longer Barrel",
                        description: ["+10% damage", "+50% Accuracy"],
                        upgradeFunction() {
                            baseStats.damage *= 1.1;
                            baseStats.bloom /= 1.5;
                        },
                        children: [                            {
                                name: "Gatling Gun+",
                                subText: "Rifling",
                                description: ["+20% Damage", "+400% Accuracy"],
                                upgradeFunction() {
                                    baseStats.damage *= 1.2;
                                    baseStats.bloom /= 4;
                                }
                            }
                        ],
                    },
                ],
            },
/*FC*/      {
                name: "Floor Cannon",
                subText: "",
                description: ["High damage & bullet size","low fire rate"],
                upgradeFunction() {
                    baseStats.fireRate = 1;
                    baseStats.damage = 13;
                    baseStats.bulletSize = 20;
                    baseStats.bloom = Math.PI/16;
                },

                children: [                    {
                        name: "Floor Cannon+",
                        subText: "More gunpowder",
                        description: ["+20% Damage", "+20% bullet size"],
                        upgradeFunction() {
                            baseStats.damage *= 1.2;
                            baseStats.bulletSize *= 1.2;
                        },

                        children: [                            {
                                name: "Floor Cannon+",
                                subText: "Flared exit",
                                description: ["+20% damage", "-40% bullet speed", "+50% bullet size"],
                                upgradeFunction() {
                                    baseStats.damage *= 1.2;
                                    baseStats.bulletSpeed *= 0.6;
                                    baseStats.bulletSize *= 1.5;
                                },
                            },
                        ],
                    },{
                        name: "Floor Cannon+",
                        subText: "Longer Barrel",
                        description: ["+10% damage", "+50% Accuracy", "+50% Bullet Speed"],
                        upgradeFunction() {
                            baseStats.damage *= 1.1;
                            baseStats.bloom /= 1.5;
                            baseStats.bulletSpeed *= 1.5;
                        },

                        children: [                            {
                                name: "Floor Cannon+",
                                subText: "Tighter exit",
                                description: ["+20% Damage", "+400% Accuracy", "+50% bullet speed"],
                                upgradeFunction() {
                                    baseStats.damage *= 1.2;
                                    baseStats.bloom /= 4;
                                    baseStats.bulletSpeed *= 1.5;
                                }
                            },
                        ],
                    },
                ],
            },
/*RR*/      {
                name: "Rod Railgun",
                subText: "",
                description: ["High damage and speed","low fire rate", "2 pierce"],
                upgradeFunction() {
                    baseStats.fireRate = 0.85;
                    baseStats.damage = 15;
                    baseStats.pierce = 2;
                    baseStats.bulletSize = 10;
                    baseStats.bloom = Math.PI/20;
                    baseStats.bulletSpeed = 55;
                },

                children: [                    {
                        name: "Rod Railgun+",
                        subText: "Sharper Rods",
                        description: ["+20% Damage", "+1 Pierce", "+20% Bullet Speed"],
                        upgradeFunction() {
                            baseStats.damage *= 1.2;
                            baseStats.pierce += 1;
                            baseStats.bulletSpeed *= 1.2;
                        },

                        children: [                            {
                                name: "Rod Railgun+",
                                subText: "Atomic Sharpness",
                                description: ["+50% damage", "+5 Pierce", "+20% Bullet Speed"],
                                upgradeFunction() {
                                    baseStats.fireRate = 1.5;
                                    baseStats.bulletSpeed *= 0.6;
                                    baseStats.bulletSize *= 1.5;
                                    baseStats.bulletSpeed *= 1.2;
                                }
                            },
                        ],
                    },{
                        name: "Rod Railgun+",
                        subText: "Follow Up",
                        description: ["+1 Burst", "-20% Damage"],
                        upgradeFunction() {
                            baseStats.damage *= 0.8;
                            baseStats.burst += 1;
                        },

                        children: [{
                                name: "Rod Railgun+",
                                subText: "Triplet",
                                description: ["+1 Burst", "-5% Damage"],
                                upgradeFunction() {
                                    baseStats.damage *= 0.95;
                                    baseStats.burst += 1;
                                }
                            },
                        ],
                    },
                ],
            },
/*PP*/      {
                name: "Pistol Pistol",
                subText: "",
                description: ["Basic pistol","but you have two"],
                upgradeFunction() {
                },

                children: [                    {
                        name: "Pistol Pistol+",
                        subText: "More Firerate",
                        description: ["+25% Firerate"],
                        upgradeFunction() {
                            baseStats.fireRate *= 1.25;
                        },

                        children: [                            {
                                name: "Pistol Pistol+",
                                subText: "More Pistol",
                                description: ["+30% Firerate"],
                                upgradeFunction() {
                                    baseStats.fireRate *= 1.3;
                                }
                            },
                        ],
                    },{
                        name: "Pistol Pistol+",
                        subText: "More Damage",
                        description: ["+25% Damage"],
                        upgradeFunction() {
                            baseStats.damage *= 1.25;
                        },

                        children: [                            {
                                name: "Pistol Pistol+",
                                subText: "Bigger Pistol",
                                description: ["+30% Damage"],
                                upgradeFunction() {
                                    baseStats.damage *= 1.3;
                                }
                            },
                        ],
                    },
                ],
            },
/*GT*/      {
                name: "Gas Tank",
                subText: "",
                description: ["Essentially a flamethrower","Semi-fast Firerate", "2 bullets & 1 pierce"],
                upgradeFunction() {
                    baseStats.fireRate = 0.14;
                    baseStats.damage = 0.8;
                    baseStats.bloom = Math.PI/5;
                    baseStats.projectiles = 2;
                    baseStats.pierce = 1;
                    baseStats.bulletSize = 20;
                    baseStats.bulletLifeTime = 0.5;
                    baseStats.bulletSpeed = 7;
                },

                children: [                    
                    {
                        name: "Gas Tank+",
                        subText: "Bigger Flames",
                        description: ["+25% Damage", "+15% Bullet Size"],
                        upgradeFunction() {
                            baseStats.damage *= 1.25;
                            baseStats.bulletSize *= 1.15;
                        },

                        children: [                            
                            {
                                name: "Gas Tank+",
                                subText: "Deeper Burn",
                                description: ["+1 Pierce"],
                                upgradeFunction() {
                                    baseStats.pierce += 1;
                                }
                            },
                        ],
                    },{
                        name: "Gas Tank+",
                        subText: "More Flames",
                        description: ["+25% Firerate"],
                        upgradeFunction() {
                            baseStats.fireRate /= 1.25;
                        },

                        children: [                            
                            {
                                name: "Gas Tank+",
                                subText: "Hotter Flames",
                                description: ["+30% FireRate"],
                                upgradeFunction() {
                                    baseStats.fireRate /= 1.3;
                                }
                            },
                        ],
                    }
                ],
            },
/*WC*/      {
                name: "War Comb",
                subText: "",
                description: ["4 Projectiles", "All projectile fire", "in a line"],
                upgradeFunction() {
                    baseStats.fireRate = 0.4;
                    baseStats.damage = 0.85;
                    baseStats.bloom = Math.PI/40;
                    baseStats.projectiles = 4;
                    baseStats.bulletSize = 15;
                    baseStats.bulletSpeed = 10;
                },

                children: [                    
                    {
                        name: "War Comb+",
                        subText: "Quick Pick",
                        description: ["+25% Firerate & Bullet Speed"],
                        upgradeFunction() {
                            baseStats.fireRate /= 1.25;
                            baseStats.bulletSize *= 1.15;
                        },

                        children: [                            
                            {
                                name: "War Comb+",
                                subText: "Long Comb",
                                description: ["+100% Base Projectiles"],
                                upgradeFunction() {
                                    baseStats.projectiles *= 2;
                                }
                            },
                        ],
                    },{
                        name: "War Comb+",
                        subText: "Sharp Needles",
                        description: ["+35% Damage", "+30% bullet speed"],
                        upgradeFunction() {
                            baseStats.damage *= 1.35;
                            baseStats.bulletSpeed *= 1.3;
                        },

                        children: [                            {
                                name: "War Comb+",
                                subText: "Piercing Needlings",
                                description: ["+1 Pierce"],
                                upgradeFunction() {
                                    baseStats.pierce += 1;
                                }
                            },
                        ],
                    }
                ],
            },
/*RB*/      {
                name: "Rubber Ball",
                subText: "",
                description: ["Medium fire-rate weapon", "with wallbounce"],
                upgradeFunction() {
                    statMult.bulletDamage = 3;
                    baseStats.fireRate = 0.15;
                    baseStats.bulletSize = 18;
                    baseStats.ball = {
                        bounces: 1,
                        dmgPer: 1,
                    };
                },

                children: [
                    {
                        name: "Rubber Ball+",
                        subText: "High Velocity",
                        description: ["Bullets gain 60% damage", "per bounce"],
                        upgradeFunction() {
                            baseStats.ball.dmgPer = 1.6;
                        },

                        children: [
                            {
                                name: "Rubber Ball+",
                                subText: "Perfect Bounce",
                                description: ["Bullets gain 120% damage", "per bounce"],
                                upgradeFunction() {
                                    baseStats.ball.dmgPer = 2.2;
                                }
                            }
                        ]
                    },{
                        name: "Rubber Ball+",
                        subText: "Extra Bounce",
                        description: ["+1 Wall bounce"],
                        upgradeFunction() {
                            baseStats.ball.bounces += 1;
                        },

                        children: [
                            {
                                name: "Rubber Ball+",
                                subText: "Bouncy Bounce",
                                description: ["+2 Wall Bounce"],
                                upgradeFunction() {
                                    baseStats.ball.bounces += 2;
                                },

                                children: [
                                    {
                                        name: "Rubber Ball+",
                                        subText: "Pinky Bounce",
                                        description: ["+2 Wall Bounce"],
                                        upgradeFunction() {
                                            baseStats.ball.bounces += 2;
                                        }
                                    }
                                ]
                            }
                        ]
                    },
                ],
            },
/*HK*/      {
                name: "Honed Katana",
                subText: "",
                description: ["Medium fire-rate weapon", "High damage Melee"],
                upgradeFunction() {
                    baseStats.fireRate = 1;
                    baseStats.damage = 16;
                    baseStats.bloom = Math.PI/5;
                    baseStats.spread = Math.PI/3;
                    baseStats.projectiles = 1;
                    baseStats.pierce = 1;
                    baseStats.bulletSize = 150;
                    baseStats.bulletLifeTime = 0.2;
                    baseStats.bulletSpeed = 0;
                },

                children: [
                    {
                        name: "Honed Katana+",
                        subText: "Large Strike",
                        description: ["+50% bullet size", "+20% damage"],
                        upgradeFunction() {
                            baseStats.bulletSize *= 1.5;
                            baseStats.damage *= 1.2;
                        },

                        children: [
                            {
                                name: "Honed Katana+",
                                subText: "Tri Strike",
                                description: ["+2 Projectiles", "+50% damage"],
                                upgradeFunction() {
                                    baseStats.projectiles += 2;
                                    baseStats.damage *= 1.5;
                                }
                            }
                        ]
                    },{
                        name: "Honed Katana+",
                        subText: "Wave",
                        description: ["Slashes Travel Forwards"],
                        upgradeFunction() {
                            baseStats.bulletSpeed = 8;
                        },

                        children: [
                            {
                                name: "Honed Katana+",
                                subText: "Sharp Wave",
                                description: ["Slashes Last Longer"],
                                upgradeFunction() {
                                    baseStats.bulletLifeTime *= 4;
                                }
                            }
                        ]
                    },
                ],
            },
/*HD*/      {
                name: "High Decibal",
                subText: "",
                description: ["Bullets are soundwaves", "that grow in size"],
                upgradeFunction() {
                    baseStats.fireRate = 0.9;
                    baseStats.damage = 7;
                    baseStats.bloom = Math.PI/10;
                    baseStats.spread = Math.PI/3;
                    baseStats.projectiles = 1;
                    baseStats.pierce = 5;
                    baseStats.bulletSize = 100;
                    baseStats.bulletLifeTime = 1.4;
                    baseStats.bulletSpeed = 4;
                    baseStats.decibalRate = 1.35;
                },

                children: [
                    {
                        name: "High Decibal+",
                        subText: "Large Speaker",
                        description: ["+50% bullet size", "+20% damage"],
                        upgradeFunction() {
                            baseStats.bulletSize *= 1.5;
                            baseStats.damage *= 1.2;
                        },

                        children: [
                            {
                                name: "High Decibal+",
                                subText: "Repetition",
                                description: ["+2 Burst", "+20% damage"],
                                upgradeFunction() {
                                    baseStats.bursts += 2;
                                    baseStats.damage *= 1.2;
                                }
                            }
                        ]
                    },{
                        name: "High Decibal+",
                        subText: "Wave",
                        description: ["Bullets Gain size faster"],
                        upgradeFunction() {
                            baseStats.decibalRate = 1.6;
                        },

                        children: [
                            {
                                name: "High Decibal+",
                                subText: "Ear Bleed",
                                description: ["Bullets also gain damage", "along with size"],
                                upgradeFunction() {
                                    baseStats.decibalDmgRate = true;
                                }
                            }
                        ]
                    },
                ],
            },
        ];
        
        const allBulletMods = [
/*BB*/      {
                name: "Big Bomb",
                subText: "",
                description: ["Bullets Explode on expiration", "with 35% damage"],
                upgradeFunction() {
                    baseStats.explode = {
                        size: 7,
                        damage: 0.35,
                    };
                },

                children: [                    
                    {
                        name: "Big Bomb+",
                        subText: "Gunpowder",
                        description: ["+50% Explosion Size"],
                        upgradeFunction() {
                            baseStats.explode.size *= 1.5;
                        },

                        children: [                            {
                                name: "Big Bomb+",
                                subText: "Thinner Coating",
                                description: ["+75% Explosion Size"],
                                upgradeFunction() {
                                    baseStats.explode.size *= 1.75;
                                }
                            },
                        ],
                    },{
                        name: "Big Bomb+",
                        subText: "Concentrate",
                        description: ["+75% Explosion Damage", "-35% Explosion Size"],
                        upgradeFunction() {
                            baseStats.explode.damage *= 2;
                            baseStats.explode.size *= 0.65;
                        },

                        children: [                            {
                                name: "Big Bomb+",
                                subText: "Hard Shell",
                                description: ["+125% Explosion Damage"],
                                upgradeFunction() {
                                    baseStats.explode.damage *= 1.25;
                                }
                            },
                        ],
                    },
                ],
            },
/*BS*/      {
                name: "Barcode Scanner",
                subText: "",
                description: ["bullets travel instantly", "and have 2 pierce"],
                upgradeFunction() {
                    statMult.pierce += 2;
                    statMult.bloom *= 0.4;
                },

                children: [                    {
                        name: "Barcode Scanner+",
                        subText: "Longer Range",
                        description: ["+1 Pierce"],
                        upgradeFunction() {
                            statMult.pierce += 1;
                        },

                        children: [                            {
                                name: "Barcode Scanner+",
                                subText: "Ranged Out",
                                description: ["+3 Pierce"],
                                upgradeFunction() {
                                    statMult.pierce += 3;
                                }
                            },
                        ],
                    },{
                        name: "Barcode Scanner+",
                        subText: "Widen",
                        description: ["+75% Bullet Size"],
                        upgradeFunction() {
                            statMult.bulletSize *= 1.75;
                        },

                        children: [                            {
                                name: "Barcode Scanner+",
                                subText: "High Tech",
                                description: ["+125% Bullet Size"],
                                upgradeFunction() {
                                    statMult.bulletSize *= 2.25;
                                }
                            },
                        ],
                    },
                ],
            },
/*SS*/      {
                name: "Shrapnel Shot",
                subText: "",
                description: ["Extra damage to an enemy", "will overflow onto", "a nearby enemy in range"],
                upgradeFunction() {
                    baseStats.overflow = {
                        num: 1,
                        mult: 1,
                        size: 250,
                    }
                },

                children: [                    {
                        name: "Shrapnel Shot+",
                        subText: "More Shrapnel",
                        description: ["+2 Enemys effected"],
                        upgradeFunction() {
                            baseStats.overflow.num += 2;
                        },

                        children: [                            {
                                name: "Shrapnel Shot+",
                                subText: "Shatter",
                                description: ["+4 Enemys effected"],
                                upgradeFunction() {
                                    baseStats.overflow.num += 4;
                                }
                            },
                        ],
                    },{
                        name: "Shrapnel Shot+",
                        subText: "Sharp Shrapnel",
                        description: ["+100% OverFlow Damage"],
                        upgradeFunction() {
                            baseStats.overflow.mult *= 2;
                        }
                    },{
                        name: "Shrapnel Shot+",
                        subText: "Large Radius",
                        description: ["+150% OverFlow Range"],
                        upgradeFunction() {
                            baseStats.overflow.size *= 2.5;
                        }
                    },
                ],
            },
/*CF*/      {
                name: "Cobra Fang",
                subText: "",
                description: ["Damage is dealt linearly", "every 2 seconds", "With 10 stack cap", "+40% bullet damage"],
                upgradeFunction() {
                    baseStats.damage *= 1.4;
                    baseStats.fang = {
                        time: 2,
                        cap: 10
                    }
                },

                children: [                   
                    {
                        name: "Cobra Fang+",
                        subText: "Hollow Fang",
                        description: ["+25 Stack Cap"],
                        upgradeFunction() {
                            baseStats.fang.cap += 25;

                        },

                        children: [                            {
                                name: "Cobra Fang+",
                                subText: "Siphon Effect",
                                description: ["Removes the stack cap"],
                                upgradeFunction() {
                                    baseStats.fang.cap = "none";
                                }
                            },
                        ],
                    },{
                        name: "Cobra Fang+",
                        subText: "Fast Action",
                        description: ["+60% Poison Damage"],
                        upgradeFunction() {
                            baseStats.fang.time /= 1.6;
                        },

                        children: [                            {
                                name: "Cobra Fang+",
                                subText: "Lethal Poison",
                                description: ["+80% Poison Damage"],
                                upgradeFunction() {
                                    baseStats.fang.time /= 1.8;
                                }
                            },
                        ],
                    },
                ],
            },
/*HG*/      {
                name: "Heavy Gears",
                subText: "",
                description: ["Holding fire increases", "firerate, but decreases", "movement speed", "", "max gain of +100%"],
                upgradeFunction() {
                    baseStats.gear = {
                        maxGain: 2,
                        gain: 0.25,
                        gainTick: 1,
                        maxLoss: 1.7,
                        loss: 0.2,
                        lossTick: 1,
                    }
                },

                children: [                   
                    {
                        name: "Heavy Gears+",
                        subText: "Grease",
                        description: ["Max gain of +300%"],
                        upgradeFunction() {
                            baseStats.gear.maxGain = 4;
                        },

                        children: [                            {
                                name: "Heavy Gears+",
                                subText: "Subtle Spinning",
                                description: ["Max gain of +600%"],
                                upgradeFunction() {
                                    baseStats.gear.maxGain = 7;
                                }
                            },
                        ],
                    },{
                        name: "Heavy Gears+",
                        subText: "Aerodynamic Design",
                        description: ["Halves the movement","speed loss"],
                        upgradeFunction() {
                            baseStats.gear.maxLoss = 1.25;
                        }
                    },
                ],
            },
/*LC*/      {
                name: "Lottery Card",
                subText: "",
                description: ["half of bullets half damage", "other half triple damage"],
                upgradeFunction() {
                    baseStats.card = {
                        loss: 0.5,
                        win: 3
                    }
                },

                children: [                   
                    {
                        name: "Lottery Card+",
                        subText: "Payout",
                        description: ["+50% winning damage"],
                        upgradeFunction() {
                            baseStats.card.win *= 1.5;
                        },

                        children: [
                        {
                            name: "Lottery Card+",
                                subText: "JACKPOT!!!",
                                description: ["1/1000 chance for a bullet", "to deal 10000% damage"],
                                upgradeFunction() {
                                    baseStats.card.jackpot = 1000;
                                }
                            },
                        ],
                    },{
                        name: "Lottery Card+",
                        subText: "Double Jeopardy",
                        description: ["All effects doubled"],
                        upgradeFunction() {
                            baseStats.card.loss *= 0.5;
                            baseStats.card.win *= 2;
                        }
                    },
                ],
            },
/*BB*/      {
                name: "Big Boi",
                subText: "",
                description: ["All projectiles & bursts", "combine into a single shot"],
                upgradeFunction() {
                },

                children: [                   
                    {
                        name: "Big Boi+",
                        subText: "Payload",
                        description: ["+40% damage"],
                        upgradeFunction() {
                            baseStats.damage *= 1.4;
                        },

                        children: [
                        {
                            name: "Big Boi+",
                                subText: "Atomic Warfare",
                                description: ["+50% damage & size"],
                                upgradeFunction() {
                                    baseStats.damage *= 1.5;
                                    baseStats.bulletSize *= 1.5;
                                }
                            },
                        ],
                    }
                ],
            },
        ];

        var upgradePool = [...allUpgrades];

        var upgradeChosenPool = [];

        var exoticUpgradePool = [];

        var upgradesAvailable = [];

        var upgradesChosen = [];
        
        var drawInputs = [];
        
        var dmgNumbers= [];

        var attackInputs = [];

        var game = {
            cursorRotation: 0,
            tick: 0,
            fps: 60,
            playing: false,
            upgrading: false,
            menu: "main",
            subMenu: false,
            select: 0,
            highestDamage: 0
        }

        if (localStorage.getItem("motionBlur")) localStorage.setItem("motionBlur", "true");
        game.motionBlur = JSON.parse(localStorage.getItem("motionBlur")); 
        if (!localStorage.getItem("displayFps")) localStorage.setItem("displayFps", "false");
        game.displayFps = JSON.parse(localStorage.getItem("displayFps")); 
        if (!localStorage.getItem("displayWaveNum")) localStorage.setItem("displayWaveNum", "true");
        game.displayWaveNum = JSON.parse(localStorage.getItem("displayWaveNum")); 
        if (!localStorage.getItem("displayDmgNum")) localStorage.setItem("displayDmgNum", "false");
        game.displayDmgNum = JSON.parse(localStorage.getItem("displayDmgNum")); 

        var baseStats = {
            weapon: "base",
            bulletMod: "base",
            pickupChance: 0.5,
            pickupStrength: 20,
            size: 20,
            acceleration: 40,
            decceleration: 6,
            maxSpeed: 7*60,
            minSpeed: 2.5,
            bulletSize: 10,
            damage: 1,
            bulletSpeed: 10,
            fireRate: 0.2,
            bursts: 0,
            projectiles: 1,
            spread: Math.PI/10,
            bloom: Math.PI/10,
            healthMax: 120,
            waveHeal: 15,
            iFrames: 150,
            pierce: 0,
        }

        var statMult = {
            size: 1,
            acceleration: 1,
            decceleration: 1,
            maxSpeed: 1,
            minSpeed: 1,
            bulletSize: 1,
            damage: 1,
            bulletSpeed: 1,
            fireRate: 1,
            bursts: 0,
            projectiles: 0,
            spread: 1,
            bloom: 1,
            healthMax: 1,
            iFrames: 1,
            pierce: 0,
        };

        var player = {
            x: canvas.width/2,
            y: canvas.height/2,
            drawRotation: 0,
            speed: 0,
            speedDir: 0,
            frTimer: 0,
            burstsLeft: baseStats.bursts+statMult.bursts,
            health: baseStats.healthMax*statMult.healthMax,
            iFrames: 0,
            lastAimDir: 0,
            lastAimFlip: false,
        }

        ctx.lineWidth = 3;
        ctx.textAlign = "center";

        var alive = true;

        //   ||===========================================||
        //   ||              G A M E P L A Y              ||
        //   ||===========================================||

        function tickLoop() {
            game.tick++;
            if (game.tick > fps*1000) game.tick=0;
            //cons=game.upgrading;
            //check frameRate
            var thisFrameTime = (thisLoop=new Date) - lastLoop;
            frameTime += (thisFrameTime - frameTime) / filterStrength;
            lastLoop = thisLoop;
            
            if (game.playing && !game.upgrading && game.fps < 10) {
                game.playing = !game.playing;
                game.menu = "pause";
            }     

            if (game.fps > 10) {
                if (!game.playing) {
                    drawEverything(() => {
                        if (!game.playing && !game.upgrading) {
                            if (game.subMenu == "options") {
                                ctx.beginPath();
                                ctx.strokeStyle = "#000000";
                                ctx.fillStyle = "#505050";
                                ctx.arc(canvas.width/2-125+37.25, canvas.height/2-300+37.25, 37.25, Math.PI/2, -Math.PI/2);
                                ctx.arc(canvas.width/2+125-37.25, canvas.height/2-300+37.25, 37.25, -Math.PI/2, Math.PI/2);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();

                                ctx.beginPath();
                                ctx.fillStyle = "#dddddd";
                                ctx.font = "50px share tech";
                                ctx.fillText("Back", canvas.width/2, canvas.height/2-250);
                                
                                ctx.beginPath();
                                ctx.strokeStyle = "#000000";
                                ctx.fillStyle = `rgb(${80 * !game.motionBlur}, ${80 * game.motionBlur}, 0)`;
                                ctx.arc(canvas.width/2-125+37.25, canvas.height/2-200+37.25, 37.25, Math.PI/2, -Math.PI/2);
                                ctx.arc(canvas.width/2+125-37.25, canvas.height/2-200+37.25, 37.25, -Math.PI/2, Math.PI/2);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();

                                ctx.beginPath();
                                ctx.font = "40px share tech";
                                ctx.fillStyle = "#dddddd";
                                ctx.fillText("Motion Blur", canvas.width/2, canvas.height/2-150);
                                
                                ctx.beginPath();
                                ctx.strokeStyle = "#000000";
                                ctx.fillStyle = `rgb(${80 * !game.displayFps}, ${80 * game.displayFps}, 0)`;
                                ctx.arc(canvas.width/2-125+37.25, canvas.height/2-100+37.25, 37.25, Math.PI/2, -Math.PI/2);
                                ctx.arc(canvas.width/2+125-37.25, canvas.height/2-100+37.25, 37.25, -Math.PI/2, Math.PI/2);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();

                                ctx.beginPath();
                                ctx.font = "40px share tech";
                                ctx.fillStyle = "#dddddd";
                                ctx.fillText("Display Fps", canvas.width/2, canvas.height/2-50);
                                
                                ctx.beginPath();
                                ctx.strokeStyle = "#000000";
                                ctx.fillStyle = `rgb(${80 * !game.displayWaveNum}, ${80 * game.displayWaveNum}, 0)`;
                                ctx.arc(canvas.width/2-125+37.25, canvas.height/2-0+37.25, 37.25, Math.PI/2, -Math.PI/2);
                                ctx.arc(canvas.width/2+125-37.25, canvas.height/2-0+37.25, 37.25, -Math.PI/2, Math.PI/2);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();

                                ctx.beginPath();
                                ctx.font = "40px share tech";
                                ctx.fillStyle = "#dddddd";
                                ctx.fillText("Display Wave#", canvas.width/2, canvas.height/2+50);
                                
                                ctx.beginPath();
                                ctx.strokeStyle = "#000000";
                                ctx.fillStyle = `rgb(${80 * !game.displayDmgNum}, ${80 * game.displayDmgNum}, 0)`;
                                ctx.arc(canvas.width/2-125+37.25, canvas.height/2+100+37.25, 37.25, Math.PI/2, -Math.PI/2);
                                ctx.arc(canvas.width/2+125-37.25, canvas.height/2+100+37.25, 37.25, -Math.PI/2, Math.PI/2);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();

                                ctx.beginPath();
                                ctx.font = "40px share tech";
                                ctx.fillStyle = "#dddddd";
                                ctx.fillText("Display Dmg#", canvas.width/2, canvas.height/2+150);
                            } else if (game.menu == "main") {
                                ctx.beginPath();
                                ctx.strokeStyle = "#000000";
                                ctx.fillStyle = "#505050";
                                ctx.arc(canvas.width/2-125+37.25, canvas.height/2-300+37.25, 37.25, Math.PI/2, -Math.PI/2);
                                ctx.arc(canvas.width/2+125-37.25, canvas.height/2-300+37.25, 37.25, -Math.PI/2, Math.PI/2);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();

                                ctx.beginPath();
                                ctx.fillStyle = "#dddddd";
                                ctx.font = "50px share tech";
                                ctx.fillText("Start", canvas.width/2, canvas.height/2-250);
                                
                                ctx.beginPath();
                                ctx.strokeStyle = "#000000";
                                ctx.fillStyle = "#505050";
                                ctx.arc(canvas.width/2-125+37.25, canvas.height/2-200+37.25, 37.25, Math.PI/2, -Math.PI/2);
                                ctx.arc(canvas.width/2+125-37.25, canvas.height/2-200+37.25, 37.25, -Math.PI/2, Math.PI/2);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();

                                ctx.beginPath();
                                ctx.fillStyle = "#dddddd";
                                ctx.font = "50px share tech";
                                ctx.fillText("Options", canvas.width/2, canvas.height/2-150);
                            } else if (game.menu == "pause") {
                                ctx.beginPath();
                                ctx.strokeStyle = "#000000";
                                ctx.fillStyle = "#505050";
                                ctx.arc(canvas.width/2-125+37.25, canvas.height/2-300+37.25, 37.25, Math.PI/2, -Math.PI/2);
                                ctx.arc(canvas.width/2+125-37.25, canvas.height/2-300+37.25, 37.25, -Math.PI/2, Math.PI/2);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();

                                ctx.beginPath();
                                ctx.fillStyle = "#dddddd";
                                ctx.font = "50px share tech";
                                ctx.fillText("Resume?", canvas.width/2, canvas.height/2-250);
                                
                                ctx.beginPath();
                                ctx.strokeStyle = "#000000";
                                ctx.fillStyle = "#505050";
                                ctx.arc(canvas.width/2-125+37.25, canvas.height/2-200+37.25, 37.25, Math.PI/2, -Math.PI/2);
                                ctx.arc(canvas.width/2+125-37.25, canvas.height/2-200+37.25, 37.25, -Math.PI/2, Math.PI/2);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();

                                ctx.beginPath();
                                ctx.fillStyle = "#dddddd";
                                ctx.font = "50px share tech";
                                ctx.fillText("Options", canvas.width/2, canvas.height/2-150);

                                ctx.beginPath();
                                ctx.strokeStyle = "#000000";
                                ctx.fillStyle = "#505050";
                                ctx.arc(canvas.width-225+37.25, 50+37.25, 37.25, Math.PI/2, -Math.PI/2);
                                ctx.arc(canvas.width-50-37.25, 50+37.25, 37.25, -Math.PI/2, Math.PI/2);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();

                                ctx.beginPath();
                                ctx.fillStyle = "#dddddd";
                                ctx.font = "30px share tech";
                                ctx.fillText("FPS: " + game.fps, canvas.width-140, 100);

                                var counter = {x: 0, y: 0}
                                upgradesChosen.forEach((item, i) => {
                                    if (item[2] != " ") {
                                        upgradeImage(50+counter.x*70, 50+counter.y*70, 0, item, 0, false, 0.35);
                                        counter.y++;
                                        if (counter.y > 9) {
                                            counter.y = 0;
                                            counter.x++;
                                        }
                                    }
                                });
                            } else if (game.menu == "death") {
                                ctx.beginPath();
                                ctx.strokeStyle = "#000000";
                                ctx.fillStyle = "#505050";
                                ctx.arc(canvas.width/2-125+37.25, canvas.height/2-300+37.25, 37.25, Math.PI/2, -Math.PI/2);
                                ctx.arc(canvas.width/2+125-37.25, canvas.height/2-300+37.25, 37.25, -Math.PI/2, Math.PI/2);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();

                                ctx.beginPath();
                                ctx.fillStyle = "#dddddd";
                                ctx.font = "50px share tech";
                                ctx.fillText("Main Menu", canvas.width/2, canvas.height/2-250);

                                ctx.strokeStyle = "#000000";
                                ctx.fillStyle = "#444444";
                                ctx.beginPath();
                                ctx.arc(canvas.width/2-250, 90, 50, Math.PI/2, -Math.PI/2);
                                ctx.arc(canvas.width/2+250, 90, 50, -Math.PI/2, Math.PI/2);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();

                                ctx.beginPath();
                                ctx.fillStyle = "#d0d0d0";
                                ctx.strokeStyle = "#000000";
                                ctx.font = "60px share tech";
                                if (player.health > 0) {
                                    ctx.fillText( "You Win", canvas.width/2, 100);
                                
                                    ctx.beginPath();
                                    ctx.strokeStyle = "#000000";
                                    ctx.fillStyle = "#505050";
                                    ctx.arc(canvas.width/2-125+37.25, canvas.height/2-200+37.25, 37.25, Math.PI/2, -Math.PI/2);
                                    ctx.arc(canvas.width/2+125-37.25, canvas.height/2-200+37.25, 37.25, -Math.PI/2, Math.PI/2);
                                    ctx.closePath();
                                    ctx.fill();
                                    ctx.stroke();

                                    ctx.beginPath();
                                    ctx.fillStyle = "#dddddd";
                                    ctx.font = "50px share tech";
                                    ctx.fillText("Continue", canvas.width/2, canvas.height/2-150);
                                }
                                else ctx.fillText( "You Died", canvas.width/2, 100,);
                            }
                            if ((game.menu == "death" || game.menu == "pause") && !game.subMenu) {
                                ctx.beginPath();
                                ctx.strokeStyle = "#000000";
                                ctx.fillStyle = "#505050";
                                ctx.arc(canvas.width/2-300+37.25, canvas.height/2-100+37.25, 37.25, Math.PI, -Math.PI/2);
                                ctx.arc(canvas.width/2+300-37.25, canvas.height/2-100+37.25, 37.25, -Math.PI/2, 0);
                                ctx.arc(canvas.width/2+300-37.25, canvas.height/2+100+37.25, 37.25, 0, Math.PI/2);
                                ctx.arc(canvas.width/2-300+37.25, canvas.height/2+100+37.25, 37.25, Math.PI/2, Math.PI);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();

                                ctx.beginPath();
                                ctx.fillStyle = "#dddddd";
                                ctx.font = "30px share tech";
                                ctx.fillText(`Highest Damage: ${Math.floor(game.highestDamage*10)/10}`, canvas.width/2, canvas.height/2-50);
                                ctx.fillText(`Damage: ${baseStats.damage*statMult.damage}`, canvas.width/2, canvas.height/2);
                                ctx.fillText(`Firerate: ${1/(baseStats.fireRate*statMult.fireRate)}/s`, canvas.width/2, canvas.height/2+50);
                                ctx.fillText(`Projectiles: ${baseStats.projectiles+statMult.projectiles}`, canvas.width/2, canvas.height/2+100);
                                ctx.fillText(`Bursts: ${baseStats.bursts+statMult.bursts}`, canvas.width/2, canvas.height/2+150);
                                
                            }
                        }
                    });
                }
                if (game.playing){
                    draw("background", [{}]);
                    //enemy
                    enemytickLoop();
                    //enemy attacks
                    handleAttackInputs();
                    //bullets
                    bulletLoopTick();
                    //player
                    playerTick();
                    //pickups
                    pickupTick();
                    //drawstuff
                    handleDrawInputs();
                    //drawstuff
                    handleDmgNums();
                    //UI
                    draw("UI", [{}]);
                    //fire
                    if (player.frTimer <= 0 && (keys.includes("mouse") || (player.burstsLeft < baseStats.bursts+statMult.bursts && baseStats.bulletMod != "Big Boi"))) {
                        while (player.frTimer <= 0) {
                            if (baseStats.weapon == "Pistol Pistol") {
                                fire(-15, Math.random()*10-10);
                                fire(15, Math.random()*10-10);
                            } else fire(0, 0);
                            if (player.burstsLeft > 0 && baseStats.bulletMod != "Big Boi") {
                                player.frTimer += baseStats.fireRate*statMult.fireRate * game.fps / 10;
                                player.burstsLeft--;
                            } else {
                                player.frTimer += baseStats.fireRate*statMult.fireRate * game.fps;
                                if (player.burstsLeft <= 0) player.burstsLeft = baseStats.bursts+statMult.bursts;
                            }
                        }
                    } else {
                        if (baseStats.gear) {
                            if (keys.includes("mouse")) {
                                baseStats.gear.gainTick *= baseStats.gear.gain/game.fps + 1;
                                if (baseStats.gear.gainTick > baseStats.gear.maxGain) baseStats.gear.gainTick = baseStats.gear.maxGain;

                                baseStats.gear.lossTick *= baseStats.gear.loss/game.fps + 1;
                                if (baseStats.gear.lossTick > baseStats.gear.maxLoss) baseStats.gear.lossTick = baseStats.gear.maxLoss;
                            } else {
                                baseStats.gear.gainTick /= baseStats.gear.gain/game.fps + 1;
                                if (baseStats.gear.gainTick < 1) baseStats.gear.gainTick = 1;

                                baseStats.gear.lossTick /= baseStats.gear.loss/game.fps + 1;
                                if (baseStats.gear.lossTick < 1) baseStats.gear.lossTick = 1;
                            }

                            if (player.frTimer > 0) player.frTimer -= baseStats.gear.gainTick;
                        } else if (player.frTimer > 0) player.frTimer--;
                    }
                }

                //draw the Upgrade Screen
                if (game.upgrading) {
                    draw("upgrades", upgradesAvailable);
                    
                    ctx.strokeStyle = "#000000";
                    ctx.fillStyle = "#444444";
                    ctx.beginPath();
                    ctx.arc(canvas.width/2-450, 90, 50, Math.PI/2, -Math.PI/2);
                    ctx.arc(canvas.width/2+50, 90, 50, -Math.PI/2, Math.PI/2);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.fillStyle = "#d0d0d0";
                    ctx.strokeStyle = "#000000";
                    ctx.font = "60px share tech";

                    if (waveNum == 0) {
                        ctx.fillText( "Pick a Weapon", canvas.width/2-200, 100,);
                    } else if (waveNum == 4) {
                        ctx.fillText( "Pick a Bullet Mod", canvas.width/2-200, 100,);
                    } else if (waveNum%4 == 0) {
                        ctx.fillText( "Upgrade your Extras", canvas.width/2-200, 100,);
                    } else {
                        ctx.fillText( "Pick an Upgrade", canvas.width/2-200, 100,);
                    }
                    
                    ctx.strokeStyle = "#000000";
                    ctx.fillStyle = "#444444";
                    ctx.beginPath();
                    ctx.arc(canvas.width/2+250, 90, 30, Math.PI/2, -Math.PI/2);
                    ctx.arc(canvas.width/2+450, 90, 30, -Math.PI/2, Math.PI/2);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.fillStyle = "#d0d0d0";
                    ctx.strokeStyle = "#000000";
                    ctx.font = "40px share tech";
                    ctx.fillText( "Choose", canvas.width/2+350, 100,);
                }
                
                //check enemys
                var enemies = false;
                enemys.forEach((item) => { if (item) enemies = true })

                if (game.playing && !game.upgrading && !enemies && !game.ease) {
                    game.ease = "upgrade";
                    setTimeout(function() {
                        if (localStorage.getItem("tutorial") != "true") localStorage.setItem("tutorial", "true");
                        game.ease = false;
                        game.playing = false;
                        upgrade();
                    }, 500 + 1500 * (pickups.length > 0));
                }

                draw("cursor", [{}]);
            } else {
                ctx.beginPath();
                ctx.fillStyle = "#444444";
                ctx.arc(canvas.width/2-200, 400, 50, Math.PI/2, -Math.PI/2);
                ctx.arc(canvas.width/2+200, 400, 50, -Math.PI/2, Math.PI/2);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();

                ctx.beginPath();
                ctx.fillStyle = "#ffffff";
                ctx.font = "70px courier";
                ctx.fillText("FPS < 10!", canvas.width/2, 420);
            }

            //outside borders
            ctx.beginPath();
            ctx.fillStyle = "#000000";
            ctx.rect(-1500, -1500, 1500, canvas.height+3000);
            ctx.rect(canvas.width, -1500, 1500, canvas.height+3000);
            ctx.rect(0, -1500, canvas.width+3000, 1500);
            ctx.rect(0, canvas.height, canvas.width, 1500);
            ctx.fill();

            requestAnimationFrame(tickLoop);
        }

        function fire(offsetX, offsetY) {
            const aimDir = Math.atan((mouseX-player.x)/(mouseY-player.y)) + Math.PI*(mouseY < player.y);
            if (baseStats.bulletMod == "Big Boi") createBullet(
                {
                    type: baseStats.weapon, damage: baseStats.damage*statMult.damage*(baseStats.projectiles+statMult.projectiles)*(baseStats.bursts+statMult.bursts+1),
                    x: player.x + Math.sin(aimDir)*(60+offsetY) + Math.sin(aimDir+Math.PI/2)*offsetX, y: player.y + Math.cos(aimDir)*(60+offsetY) + Math.cos(aimDir+Math.PI/2)*offsetX, dir: aimDir, pierce: baseStats.pierce + statMult.pierce,
                    explode: Boolean(baseStats.explode), speed: baseStats.bulletSpeed*statMult.bulletSpeed*60/game.fps, size: baseStats.bulletSize*statMult.bulletSize*(1+(baseStats.projectiles+statMult.projectiles)/10)*(1+(baseStats.bursts+statMult.bursts+1)/10)
                },{
                    bloom: baseStats.bloom*statMult.bloom
                }
            );
            else createBullet(
                {
                    type: baseStats.weapon, damage: baseStats.damage*statMult.damage,
                    x: player.x + Math.sin(aimDir)*(60+offsetY) + Math.sin(aimDir+Math.PI/2)*offsetX, y: player.y + Math.cos(aimDir)*(60+offsetY) + Math.cos(aimDir+Math.PI/2)*offsetX, dir: aimDir, pierce: baseStats.pierce + statMult.pierce,
                    explode: Boolean(baseStats.explode), speed: baseStats.bulletSpeed*statMult.bulletSpeed*60/game.fps, size: baseStats.bulletSize*statMult.bulletSize
                },{ 
                    projectiles: baseStats.projectiles+statMult.projectiles, spread: baseStats.spread*statMult.spread, 
                    bloom: baseStats.bloom*statMult.bloom
                }
            );
        }

        function playerTick() {
            draw("player", [{x: player.x, y: player.y, size: baseStats.size*statMult.size, rotate: true}]);
            player.lastAimDir = -Math.atan((mouseX-player.x)/(mouseY-player.y)) + Math.PI*(mouseY < player.y) + Math.PI/2
            player.lastAimFlip = mouseX < player.x
            upgradeImage(player.x, player.y, 60, baseStats.weapon, player.lastAimDir, player.lastAimFlip, 0.5);

            const isMoving = !!((keys.includes("w") - keys.includes("s")) || (keys.includes("a") - keys.includes("d")));
        
            var dir = Math.atan((keys.includes("d") - keys.includes("a"))/(keys.includes("s") - keys.includes("w"))) + Math.PI*(keys.includes("w"));
            if (!(keys.includes("s") - keys.includes("w"))) dir = (keys.includes("d") - keys.includes("a"))*Math.PI/2;
            var s;
            if (baseStats.gear) {
                s = {vx: Math.sin(player.speedDir)*player.speed+isMoving*Math.sin(dir)*baseStats.acceleration*statMult.acceleration/game.fps/baseStats.gear.lossTick,
                vy: Math.cos(player.speedDir)*player.speed+isMoving*Math.cos(dir)*baseStats.acceleration*statMult.acceleration/game.fps/baseStats.gear.lossTick}
            } else s = {vx: Math.sin(player.speedDir)*player.speed+isMoving*Math.sin(dir)*baseStats.acceleration*statMult.acceleration/game.fps, 
                vy: Math.cos(player.speedDir)*player.speed+isMoving*Math.cos(dir)*baseStats.acceleration*statMult.acceleration/game.fps};
            //borders
            if (player.x-baseStats.size < 0 && s.vx < 0 ) {
                s.vx *= -1;
                player.x = baseStats.size;
            } else if (player.x+baseStats.size > canvas.width && s.vx > 0 ) {
                s.vx *= -1;
                player.x = canvas.width-baseStats.size;
            }
            if (player.y-baseStats.size < 0 && s.vy < 0 ) {
                s.vy *= -1;
                player.y = baseStats.size;
            } else if (player.y+baseStats.size > canvas.height && s.vy > 0 ) {
                s.vy *= -1;
                player.y = canvas.height-baseStats.size;
            }
            player.speed = Math.hypot(s.vx, s.vy);
            if (s.vy != 0) player.speedDir = Math.atan(s.vx/s.vy) + Math.PI*(s.vy < 0);
            else player.speedDir = Math.sign(s.vx) + Math.PI*(s.vy < 0);
            var speedMax = baseStats.maxSpeed*statMult.maxSpeed/game.fps;
            if (baseStats.gear) speedMax /= baseStats.gear.lossTick;
            if (player.speed > speedMax) player.speed = speedMax;

            if (!isMoving) {
                const dec = baseStats.decceleration*statMult.decceleration/game.fps+1;
                if (dec > 1) player.speed /= dec;
                if (player.speed < baseStats.minSpeed*statMult.minSpeed*60/game.fps) player.speed = 0;
            }

            player.x += Math.sin(player.speedDir)*player.speed;
            player.y += Math.cos(player.speedDir)*player.speed;

            if (player.iFrames > 0) player.iFrames--;

            if (player.health <= 0) {
                game.playing = false;
                game.menu = 'death';

                //background
                ctx.beginPath();
                ctx.fillStyle = "#cccccc88";
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.beginPath();
                ctx.strokeStyle = "#000000";
                ctx.fillStyle = "#505050";
                ctx.rect(canvas.width/2-125, canvas.height/2-300, 250, 75);
                ctx.fill();
                ctx.stroke();

                ctx.beginPath();
                ctx.fillStyle = "#dddddd";
                ctx.font = "50px share tech";
                ctx.fillText("Main Menu", canvas.width/2, canvas.height/2-250);
            }
        }

        function upgrade() {
            if (!game.upgrading) {
                game.select = 0;

                var tempUpgradePool = upgradePool;
                var tempUpgradeChosenPool = upgradeChosenPool;
                if (waveNum == 0) {
                    tempUpgradePool = allWeapons;
                    tempUpgradeChosenPool = [];
                }
                else if (waveNum == 4) {
                    tempUpgradePool = allBulletMods;
                    tempUpgradeChosenPool = [];
                }
                else if (waveNum%4 == 0 && exoticUpgradePool.length > 0) {
                    tempUpgradePool = exoticUpgradePool;
                    tempUpgradeChosenPool = [];
                }
                    
                if (tempUpgradePool.length+tempUpgradeChosenPool.length > 0 && waveNum != 40) {
                    game.upgrading = true;

                    var temp;
                    var tempType;
                    if (tempUpgradeChosenPool.length > 0 && (tempUpgradePool.length == 0 || Math.random() > 0.5 ) && (waveNum%4 != 0 || exoticUpgradePool.length <= 0)) {
                        var temp = Math.floor(Math.random()*tempUpgradeChosenPool.length);
                        upgradesAvailable.push(tempUpgradeChosenPool[temp]);
                        upgradesAvailable[0].placement = temp;
                        var tempType = "chosen";
                    } else if (tempUpgradePool.length > 0) {
                        var temp = Math.floor(Math.random()*tempUpgradePool.length);
                        upgradesAvailable.push(tempUpgradePool[temp]);
                        upgradesAvailable[0].placement = temp;
                        var tempType = "new";
                    }

                    if (tempUpgradePool.length+tempUpgradeChosenPool.length > 1) {
                        var temp2;
                        var tempType2;
                        var counter = 0;
                        if (tempType == "chosen") counter++;
                        if (tempUpgradeChosenPool.length > counter && (tempUpgradePool.length <= 1-counter || Math.random() > 0.5 ) && (waveNum%4 != 0 || exoticUpgradePool.length <= 0)) {
                            tempType2 = "chosen";
                            temp2 = Math.floor(Math.random()*tempUpgradeChosenPool.length);
                            while(temp == temp2 && tempType == tempType2) temp2 = Math.floor(Math.random()*tempUpgradeChosenPool.length);
                            upgradesAvailable.push(tempUpgradeChosenPool[temp2]);
                            upgradesAvailable[1].placement = temp2;
                        } else if (tempUpgradePool.length > 1-counter) {
                            tempType2 = "new";
                            temp2 = Math.floor(Math.random()*tempUpgradePool.length);
                            while(temp == temp2 && tempType == tempType2) temp2 = Math.floor(Math.random()*tempUpgradePool.length);
                            upgradesAvailable.push(tempUpgradePool[temp2]);
                            upgradesAvailable[1].placement = temp2;
                        }
                        if (tempUpgradePool.length+tempUpgradeChosenPool.length > 2) {
                            var temp3;
                            var tempType3;
                            var counter = 0;
                            if (tempType == "chosen") counter++;
                            if (tempType2 == "chosen") counter++;
                            if (tempUpgradeChosenPool.length > counter && (tempUpgradePool.length <= 2-counter || Math.random() > 0.5 ) && (waveNum%4 != 0 || exoticUpgradePool.length <= 0)) {
                                tempType3 = "chosen";
                                temp3 = Math.floor(Math.random()*tempUpgradeChosenPool.length);
                                while((temp == temp3 && tempType == tempType3) || (temp2 == temp3 && tempType2 == tempType3)) temp3 = Math.floor(Math.random()*tempUpgradeChosenPool.length);
                                upgradesAvailable.push(tempUpgradeChosenPool[temp3]);
                                upgradesAvailable[2].placement = temp3;
                            } else if (tempUpgradePool.length > 2-counter) {
                                tempType3 = "new";
                                temp3 = Math.floor(Math.random()*tempUpgradePool.length);
                                while((temp == temp3 && tempType == tempType3) || (temp2 == temp3 && tempType2 == tempType3)) temp3 = Math.floor(Math.random()*tempUpgradePool.length);
                                upgradesAvailable.push(tempUpgradePool[temp3]);
                                upgradesAvailable[2].placement = temp3;
                            }
                        }
                    }
                } else {
                    waveNum++;
                    game.playing = false;
                    game.menu = "death";
                }

            } else {
                var chosenUpgrade = upgradesAvailable[game.select];
                game.upgrading = false;
                game.playing = true;

                upgradesAvailable.splice(0, upgradesAvailable.length);

                if (waveNum%4 == 0 && (exoticUpgradePool.length > 0 || waveNum < 5)) {
                    if (waveNum > 4) exoticUpgradePool.splice(exoticUpgradePool.indexOf(chosenUpgrade), 1);

                    if (chosenUpgrade.children) {
                        exoticUpgradePool.push(...chosenUpgrade.children);
                    }
                }
                else if (waveNum%4 != 0) {
                    if (chosenUpgrade.subText == "Singleton");
                    else if (chosenUpgrade.subText) {
                        upgradeChosenPool.splice(upgradeChosenPool.indexOf(chosenUpgrade), 1);
                    }
                    else {
                        upgradePool.splice(upgradePool.indexOf(chosenUpgrade), 1);
                    }

                    if (chosenUpgrade.children) {
                        upgradeChosenPool.push(...chosenUpgrade.children);
                    }
                }

                //bullets = [];

                chosenUpgrade.upgradeFunction();
                if (waveNum == 0) baseStats.weapon = chosenUpgrade.name;
                if (waveNum == 4) baseStats.bulletMod = chosenUpgrade.name;
                if (chosenUpgrade.subText) {
                    var initials = chosenUpgrade.name[0];

                    for (var i = 0; i < chosenUpgrade.name.length; i++) {
                        if (chosenUpgrade.name[i] == " ") initials += chosenUpgrade.name[i+1];
                    }

                    upgradesChosen.push(initials + " - " + chosenUpgrade.subText);
                } else {
                    upgradesChosen.push(chosenUpgrade.name);
                }
                
                spawnWave();
            }
        }

        //   ||===========================================||
        //   ||               P I C K U P S               ||
        //   ||===========================================||

        function createPickup(x, y, type) {
            pickups.push({x: x, y: y, type: type});
        }

        function pickupTick() {
            pickups.forEach((item,i) => {
                draw(item.type, [{x: item.x, y: item.y, size: 4}]);

                if (Math.hypot(player.x - item.x, player.y - item.y) < 60) {
                    player.health += baseStats.pickupStrength;
                    if (player.health > baseStats.healthMax*statMult.healthMax) player.health = baseStats.healthMax*statMult.healthMax;
                    pickups.splice(i,1);
                    createDrawInput({x: item.x, y: item.y, size: 2}, 0.3, "healthPickup");
                }
            });
        }
        
        //   ||===========================================||
        //   ||               B U L L E T S               ||
        //   ||===========================================||

        function bulletLoopTick() {
            bullets.push(...bulletBuffer);
            bulletBuffer = [];
            bullets = bullets.filter(
                (item, i) => (bulletTick(item, i))
            );
        }

        function bulletTick(bullet, i) {
            alive = true;

            if (baseStats.bulletLifeTime) {
                if (bullet.tick > baseStats.bulletLifeTime*game.fps) {
                    alive = false;
                } else bullet.tick++;
            }

            if (baseStats.bulletMod == "Barcode Scanner") {
                bullet.type = "barcode"
                
                var start = {x: bullet.x, y: bullet.y}
                    
                bullet.x -= Math.sin(bullet.dir)*bullet.size;
                bullet.y -= Math.cos(bullet.dir)*bullet.size;

                while (alive) {
                    var tickMove = {x: Math.sin(bullet.dir)*bullet.size, y: Math.cos(bullet.dir)*bullet.size};

                    if (baseStats.bulletLifeTime) {
                        if (bullet.tick > baseStats.bulletLifeTime*game.fps) {
                            alive = false;
                        } else bullet.tick += bullet.size/Math.max(0.001, baseStats.bulletSpeed*statMult.bulletSpeed);
                    }
                    
                    bullet.x += tickMove.x;
                    bullet.y += tickMove.y;

                    bulletHitScan(bullet, i);

                    if (baseStats.dmgPerDist) bullet.damage += baseStats.dmgPerDist*bullet.speed;

                    if (baseStats.decibalRate) bullet.size += bullet.size*baseStats.decibalRate/game.fps;
                    if (baseStats.decibalDmgRate) bullet.damage += bullet.damage*baseStats.decibalRate/game.fps;
                    
                    //borders
                    if (bullet.x < 0 || bullet.x > canvas.width ||
                        bullet.y < 0 || bullet.y > canvas.height) { 
                        if (bullet.bounces > 0) {
                            bullet.bounces--;
                            if (bullet.x < 0 || bullet.x > canvas.width) {
                                tickMove.x *= -1;
                                bullet.x = Math.max(Math.min(bullet.x, canvas.width), 0);
                            }
                            if (bullet.y < 0 || bullet.y > canvas.height) {
                                tickMove.y *= -1;
                                bullet.y = Math.max(Math.min(bullet.y, canvas.height), 0);
                            }
                            bullet.dir = Math.atan(tickMove.x/tickMove.y) + Math.PI * (tickMove.y < 0);
                            bullet.damage *= baseStats.ball.dmgPer;

                            createDrawInput({x: bullet.x, y: bullet.y, size: bullet.size, start: {x: start.x, y: start.y}}, 0.3, "scanner ray");
                            start = {x: bullet.x, y: bullet.y};
                        } else if (bullet.x < -bullet.size || bullet.x > canvas.width+bullet.size ||
                        bullet.y < -bullet.size || bullet.y > canvas.height+bullet.size) alive = false;
                    };
                }
                
                createDrawInput({x: bullet.x, y: bullet.y, size: bullet.size, start: {x: start.x, y: start.y}}, 0.3, "scanner ray");
                
                ctx.lineWidth -= bullet.size;

                return alive;
            } else {
                draw("bullet", [{x: bullet.x, y: bullet.y, size: bullet.size, dir: bullet.dir, type: bullet.type}]);

                //hit checks inbetween bullet size so that no enemy gets missed
                const finalMove = bullet.speed%bullet.size;
                const moveDist = bullet.speed-finalMove;
                var timesToMove = 0;
                if (moveDist > 0 && baseStats.weapon == "High Decibal") timesToMove = Math.floor((bullet.speed-finalMove)/50);
                else if (moveDist > 0) timesToMove = Math.floor((bullet.speed-finalMove)/bullet.size);

                while(timesToMove > 0) {
                    bullet.x += Math.sin(bullet.dir)*bullet.size;
                    bullet.y += Math.cos(bullet.dir)*bullet.size;

                    bulletHitScan(bullet, i);
                    timesToMove--;
                }

                bullet.x += Math.sin(bullet.dir)*finalMove;
                bullet.y += Math.cos(bullet.dir)*finalMove;

                bulletHitScan(bullet, i);

                if (baseStats.dmgPerDist) bullet.damage += baseStats.dmgPerDist*bullet.speed;

                if (baseStats.decibalRate) bullet.size += bullet.size*baseStats.decibalRate/game.fps;
                if (baseStats.decibalDmgRate) bullet.damage += bullet.damage*baseStats.decibalRate/game.fps;
            }
            var tickMove = {x: Math.sin(bullet.dir), y: Math.cos(bullet.dir)};
                    
            //borders
            if (bullet.x < 0 || bullet.x > canvas.width ||
                bullet.y < 0 || bullet.y > canvas.height) { 
                if (bullet.bounces > 0) {
                    bullet.bounces--;
                    if (bullet.x < 0 || bullet.x > canvas.width) {
                        tickMove.x *= -1;
                        bullet.x = Math.max(Math.min(bullet.x, canvas.width), 0);
                    }
                    if (bullet.y < 0 || bullet.y > canvas.height) {
                        tickMove.y *= -1;
                        bullet.y = Math.max(Math.min(bullet.y, canvas.height), 0);
                    }
                    bullet.dir = Math.atan(tickMove.x/tickMove.y) + Math.PI * (tickMove.y < 0);
                    bullet.damage *= baseStats.ball.dmgPer;
                } else alive = false;
            };

            if (bullet.type == "explosion") {
                alive = false
            }

            //deadchecks
            if (alive == false) {
                createDrawInput({type: bullet.type, x: bullet.x, y: bullet.y, vx: bullet.speed*Math.sin(bullet.dir)/2, vy: bullet.speed*Math.cos(bullet.dir)/2, dir: bullet.dir, size: bullet.size}, 0.3, "bullet");
            }
            
            if (alive == false && bullet.explode) {
                if (bullet.type == "Honed Katana") bullet.size *= 0.2;
                if (bullet.type == "High Decibal") bullet.size *= 0.07;
                createBullet({type: "explosion", x: bullet.x, y: bullet.y, speed: 0, size: bullet.size*baseStats.explode.size, damage: bullet.damage*baseStats.explode.damage}, {});
            }
            
            return alive;
        }

        function bulletHitScan(bulletInput,i,overflow) {
            const bullet = bulletInput;

            var closest = "none";
            var cDist;
            if (overflow) cDist = baseStats.overflow.size;
            enemys.forEach((enemy2, i2) => { if (enemy2) {
                var dist = Math.max(0, Math.hypot( enemy2.x - bullet.x, enemy2.y - bullet.y ) - bullet.size/2 - enemy2.size/2);

                if (bullet.type == "High Decibal" && dist <= 0 && dist > -50) {
                    let ratio = (
                        (enemy2.x - bullet.x) * Math.sin(bullet.dir)*bullet.size/2
                        + (enemy2.y - bullet.y) * Math.cos(bullet.dir)*bullet.size/2
                    ) / ( 
                        (dist + bullet.size/2 + enemy2.size/2) * (bullet.size/2)
                    )

                    if (ratio > 0.5) dist = 0;
                    else dist = 1;
                }

                if (enemy2.size > 300) if (bullet.x+bullet.size/2 >= enemy2.x-enemy2.size/2 && bullet.x-bullet.size/2 <= enemy2.x+enemy2.size/2 && 
                    bullet.y+bullet.size/2 >= enemy2.y-enemy2.size/2 && bullet.y-bullet.size/2 <= enemy2.y+enemy2.size/2
                ) dist = 0;
                
                if (dist < cDist && !bullet.ignoreEnemys.includes(i2) && overflow && enemy2.health > 0) {
                    cDist = dist;
                    closest = i2;
                } else if (dist <= 0 && !bullet.ignoreEnemys.includes(i2) && enemy2.health > 0) {
                    if (baseStats.overflow && !overflow && enemy2.health < bullet.damage) {
                        var tempBullet = Object.assign({}, bullet);
                        tempBullet.damage -= enemy2.health;
                        tempBullet.damage *= baseStats.overflow.mult;
                        tempBullet.ignoreEnemys = [i2];
                        for (var a = 0; a < baseStats.overflow.num; a++) bulletHitScan(tempBullet,i,true);

                        createDrawInput({x: bullet.x, y: bullet.y, size: baseStats.overflow.size, targets: []}, 1, "overflow");
                    }

                    if (baseStats.bloodyScythe) {
                        if (!enemy2.effects) enemy2.effects = {};
                        if (!enemy2.effects.bSStacks) enemy2.effects.bSStacks = 0;
                        if (enemy2.effects.bSStacks < baseStats.bloodyScythe.cap) enemy2.effects.bSStacks++;
                        if (!enemy2.effects.bSOffset) enemy2.effects.bSOffset = game.tick;
                    }

                    if (baseStats.fang) {
                        if (!enemy2.effects) enemy2.effects = {};
                        if (!enemy2.effects.fangStacks) enemy2.effects.fangStacks = 0;
                        if (!enemy2.effects.fangDamage) enemy2.effects.fangDamage = 0;

                        if (enemy2.effects.fangStacks < baseStats.fang.cap || baseStats.fang.cap == "none") {
                            enemy2.effects.fangStacks++;
                            enemy2.effects.fangDamage += bullet.damage/baseStats.fang.time;
                        }
                    } else {
                        enemy2.health -= bullet.damage;
                        enemy2.dmgThisFrame += bullet.damage;
                    }

                    enemy2.speed *= 0.9;

                    if (bullet.pierce <= 0) {
                        alive = false;
                    } else {
                        bullet.pierce--;
                        if (baseStats.dmgPerPierce) bullet.damage *= baseStats.dmgPerPierce;
                    }
                    
                    if (!overflow) bullet.ignoreEnemys.push(i2);
                } 
                
                if (dist > bullet.size/2+enemy2.size/2 && bullet.ignoreEnemys.includes(i2)) {
                    bullet.ignoreEnemys.splice(bullet.ignoreEnemys.indexOf(i2), 1);
                }
            }});
            if (overflow && closest != "none") {
                bullet.ignoreEnemys.push(closest);

                enemys[closest].speed *= 0.9;
                enemys[closest].health -= bullet.damage;
                enemys[closest].dmgThisFrame += bullet.damage;
            }
        }

        function createBullet(spawnStats, customs) {
            if (!spawnStats.x) spawnStats.x = player.x;
            if (!spawnStats.y) spawnStats.y = player.y;
            if (!spawnStats.dir) spawnStats.dir = 0;
            if (!spawnStats.speed) spawnStats.speed = 0;
            if (!spawnStats.size) spawnStats.size = 10;
            if (!spawnStats.pierce) spawnStats.pierce = 0;
            if (!spawnStats.damage) spawnStats.damage = 1;
            if (!spawnStats.tick) spawnStats.tick = 0;
            if (!customs.spread) customs.spread = Math.PI/3;
            if (!customs.projectiles) customs.projectiles = 1;
            if (!customs.bloom) customs.bloom = Math.PI/100;

            if (baseStats.ball) spawnStats.bounces = baseStats.ball.bounces;
            var combOffset = 0;
            if (customs.projectiles > 1) if (baseStats.weapon == "War Comb") {
                combOffset = -customs.spread/Math.PI*250;
            } else spawnStats.dir -= customs.spread/2;
            
            for (var i = 0; i < customs.projectiles; i++) {
                spawnStats.ignoreEnemys = [];
                var obj = Object.assign({}, spawnStats);
                obj.x += Math.sin(obj.dir+Math.PI/2)*combOffset;
                obj.y += Math.cos(obj.dir+Math.PI/2)*combOffset;
                //Metal Coil
                if (upgradesChosen.includes("Metal Coil")) {
                    if (upgradesChosen.includes("Metal Coil") && Math.random() <= baseStats.metalCoil.critChance) {
                        obj.size *= baseStats.metalCoil.critScaling;
                        obj.damage *= baseStats.metalCoil.critScaling;
                    } else {
                    //Power Coil
                        if (upgradesChosen.includes("MC - Thickest Wire") && Math.random() <= baseStats.metalCoil.critChance) {
                            obj.size *= baseStats.metalCoil.pCritScaling;
                            obj.damage *= baseStats.metalCoil.pCritScaling;
                        }
                    }
                }
                //Lottery card
                if (baseStats.bulletMod == "Lottery Card") {
                    //jackpot
                    if (baseStats.card.jackpot && Math.random() <= 0.001) {
                        obj.damage *= baseStats.card.jackpot;
                    }
                    else if (Math.random() <= 0.5) {
                        obj.damage *= baseStats.card.win;
                    } else {
                        obj.damage *= baseStats.card.loss;
                    }
                }

                if (baseStats.weapon == "Honed Katana") {
                    obj.x -= Math.sin(obj.dir)*obj.size;
                    obj.y -= Math.cos(obj.dir)*obj.size;
                } else if (baseStats.weapon == "High Decibal") {
                    obj.x -= Math.sin(obj.dir)*obj.size*0.35;
                    obj.y -= Math.cos(obj.dir)*obj.size*0.35;
                }
                obj.dir += customs.bloom*(Math.random()-0.5);
                if (baseStats.weapon == "Honed Katana") {
                    obj.x += Math.sin(obj.dir)*obj.size;
                    obj.y += Math.cos(obj.dir)*obj.size;
                }
                bulletBuffer.push(obj);
                if (baseStats.weapon == "War Comb") {
                    combOffset += customs.spread/(customs.projectiles-1)/Math.PI*500;
                } else spawnStats.dir += customs.spread/(customs.projectiles-1);
            }
        }
        
        //   ||===========================================||
        //   ||               E N E M I E S               ||
        //   ||===========================================||

        function spawnWave() {
            bullets = [];
            bulletBuffer = [];
            enemys = [];
            enemyBuffer = [];
            pickups = [];

            waveNum++;
            if (true) {// unused
                if (waveNum == 10) {
                    switch(String(Math.floor(Math.random()*0))) {
                        case "0": {
                            
                            createEnemy({type: "necroSword", ai: "necroSword", spawnDelay: game.fps*2, x: canvas.width/2, y: -500, health: 500, acc: 6, maxSpeed: 7, size: 100, hitDamage: 40});

                            break;
                        }
                    }
                } else if (waveNum == 20) {
                    switch(String(Math.floor(Math.random()*2))) {
                        case "0": {
                            for (var a = 0; a < 2; a++) createEnemy({type: "sword", ai: "dash", dashDist: 0, dashDelay: 0.5, x: canvas.width/2-200+400*a, y: -500, health: 1000, acc: 50, maxSpeed: 40, size: 55, hitDamage: 15});
                            createEnemy({type: "bigSword", ai: "dash", dashDist: 0, dashDelay: 0.5, x: canvas.width/2-200+400*a, y: -500, health: 5000, acc: 50, maxSpeed: 40, size: 55, hitDamage: 15});
                            
                            break;
                        } case "1": {
                            createEnemy({type: "BigBoi", ai: "orbit", x: canvas.width/2-200+400*a, y: -500, health: 10000, acc: 3, maxSpeed: 3, size: 700, hitDamage: 15});
                            
                            break;
                        }
                    }
                } else if (waveNum == 30) {
                    switch(String(Math.floor(Math.random()*0))) {
                        case "0": {
                            createEnemy({type: "shooterBoss", ai: "shoot", x: canvas.width/2-200+400*a, y: -500, health: 7500, acc: 25, maxSpeed: 35, size: 40, hitDamage: 6,
                                delay: 0.2, shotSize: 70, shotDelay: 1.5, shotDamage: 15
                            });
                            createEnemy({type: "shooterBoss2", ai: "shoot", x: canvas.width/2-200+400*a, y: canvas.height+500, health: 7500, acc: 45, maxSpeed: 40, size: 40, hitDamage: 6,
                                delay: 0.05, shotSize: 40, shotDelay: 1.5, shotDamage: 15
                            });
                            break;
                        }
                    }
                } else if (waveNum == 40) {
                    switch(String(Math.floor(Math.random()*0))) {
                        case "0": {
                            createEnemy({type: "shooterBossFinale", ai: "shoot", x: canvas.width/2-200+400*a, y: -500, health: 100000, acc: 25, maxSpeed: 35, size: 40, hitDamage: 6,
                                delay: 0.03, shotSize: 150, shotDelay: 1.25, shotDamage: 35
                            });
                            break;
                        }
                    }
                } else {
                    var points = ((waveNum+1)*5)**1.2
                    while (points > 0) {
                        var eX, eY;
                        switch(String(Math.floor(Math.random()*4))) {
                            case "0": {
                                eX = -200-Math.random()*1000;
                                eY = Math.random()*canvas.height;

                                break;
                            }
                            case "1": {
                                eX = canvas.width+200+Math.random()*1000;
                                eY = Math.random()*canvas.height;

                                break;
                            }
                            case "2": {
                                eX = Math.random()*canvas.width;
                                eY = -200-Math.random()*1000;

                                break;
                            }
                            case "3": {
                                eX = Math.random()*canvas.width;
                                eY = canvas.height+200+Math.random()*1000;

                                break;
                            }
                            default: {

                            }
                        }
                        switch(String(Math.ceil((Math.random()*Math.min(4000, points**1))))) {
                            case "1": {
                                createEnemy({type: "tiny", ai: "orbit", x: eX, y: eY, health: 4, acc: 16, maxSpeed: 8, size: 15, hitDamage: 8});
                                points -= 1;
                                break;
                            }
                            case "2": {
                                createEnemy({type: "small", ai: "orbit", x: eX, y: eY, health: 10, acc: 16, maxSpeed: 6, size: 25, hitDamage: 10});
                                points -= 2;
                                break;
                            }
                            case "3": {
                                createEnemy({type: "tiny", ai: "orbit", x: eX, y: eY, health: 1.5, acc: 5, maxSpeed: 20, size: 20, hitDamage: 8, frictionLess: true});
                                points -= 3;
                                break;
                            }
                            case "4": {
                                createEnemy({type: "medium", ai: "orbit", x: eX, y: eY, health: 35, acc: 5, maxSpeed: 6, size: 35, hitDamage: 15});
                                points -= 4;
                                break;
                            }
                            case "8": {
                                createEnemy({type: "sword", ai: "dash", dashDist: 0, dashDelay: 1.3, x: eX, y: eY, health: 30, acc: 15, maxSpeed: 30, size: 55, hitDamage: 10});
                                points -= 8;
                                break;
                            }
                            case "10": {
                                createEnemy({type: "tiny", ai: "orbit", x: eX, y: eY, health: 20, acc: 14, maxSpeed: 7, size: 30, hitDamage: 10});
                                points -= 10;
                                break;
                            }
                            case "20": {
                                createEnemy({type: "shooter", ai: "shoot", x: eX, y: eY, health: 30, acc: 15, maxSpeed: 25, size: 30, hitDamage: 6,
                                    delay: 2+Math.random(), shotSize: 80, shotDelay: 1.5, shotDamage: 20
                                });
                                points -= 20;
                                break;
                            }
                            case "30": {
                                createEnemy({type: "shooter", ai: "shoot", x: eX, y: eY, health: 30, acc: 15, maxSpeed: 25, size: 30, hitDamage: 6,
                                    delay: 0.75+Math.random()/40, shotSize: 30, shotDelay: 1.6, shotDamage: 5
                                });
                                points -= 30;
                                break;
                            }
                            case "40": {
                                createEnemy({type: "medium", ai: "dash", dashDist: 0, dashDelay: 1,  x: eX, y: eY, health: 200, acc: 10, maxSpeed: 8, size: 120, hitDamage: 20});
                                points -= 40;
                                break;
                            }
                            case "130": {
                                createEnemy({type: "necroSwordEnemy", ai: "necroSword", spawnDelay: game.fps*2, x: canvas.width/2, y: -500, health: 500, acc: 6, maxSpeed: 7, size: 100, hitDamage: 40});
                                points -= 130;
                                break;
                            }
                            case "25": {
                                for(var a = 0; a < 30; a++) createEnemy({type: "tiny", ai: "orbit", x: eX+a, y: eY, health: 4, acc: 16, maxSpeed: 8, size: 15, hitDamage: 8});
                                points -= 25;
                                break;
                            }
                            case "35": {
                                for(var a = 0; a < 5; a++) createEnemy({type: "tiny", ai: "orbit", x: eX+a*20, y: eY, health: 1.5, acc: 5, maxSpeed: 20, size: 20, hitDamage: 8, frictionLess: true});
                                points -= 30;
                                break;
                            }
                            case "150": {
                                createEnemy({type: "shooter", ai: "shoot", x: eX, y: eY, health: 650, acc: 15, maxSpeed: 25, size: 80, hitDamage: 15,
                                    delay: 0.75+Math.random()/40, shotSize: 40, shotDelay: 1.5, shotDamage: 5
                                });
                                points -= 150;
                                break;
                            }
                            case "250": {
                                createEnemy({type: "shooter", ai: "shoot", x: eX, y: eY, health: 3500, acc: 25, maxSpeed: 35, size: 40, hitDamage: 6,
                                    delay: 0.2, shotSize: 70, shotDelay: 1.5, shotDamage: 15
                                });
                                points -= 250;
                                break;
                            }
                            case "251": {
                                createEnemy({type: "shooter", ai: "shoot", x: eX, y: eY, health: 3500, acc: 45, maxSpeed: 40, size: 40, hitDamage: 6,
                                    delay: 0.05, shotSize: 40, shotDelay: 1.5, shotDamage: 15
                                });
                                points -= 250;
                                break;
                            }
                            case "500": {
                                createEnemy({type: "tiny", ai: "orbit", x: eX, y: eY, health: 4000, acc: 16, maxSpeed: 8, size: 25, hitDamage: 8});
                                points -= 1;
                                break;
                            }
                            case "1000": {
                                createEnemy({type: "small", ai: "orbit", x: eX, y: eY, health: 10000, acc: 16, maxSpeed: 6, size: 35, hitDamage: 10});
                                points -= 2;
                                break;
                            }
                            case "1500": {
                                createEnemy({type: "tiny", ai: "orbit", x: eX, y: eY, health: 1500, acc: 5, maxSpeed: 20, size: 35, hitDamage: 8, frictionLess: true});
                                points -= 3;
                                break;
                            }
                            case "2000": {
                                createEnemy({type: "medium", ai: "orbit", x: eX, y: eY, health: 35000, acc: 5, maxSpeed: 6, size: 65, hitDamage: 15});
                                points -= 4;
                                break;
                            }
                            case "1600": {
                                createEnemy({type: "sword", ai: "dash", dashDist: 0, dashDelay: 1.3, x: eX, y: eY, health: 30000, acc: 15, maxSpeed: 30, size: 85, hitDamage: 10});
                                points -= 8;
                                break;
                            }
                            case "5000": {
                                createEnemy({type: "tiny", ai: "orbit", x: eX, y: eY, health: 20000, acc: 14, maxSpeed: 7, size: 30, hitDamage: 10});
                                points -= 10;
                                break;
                            }
                            case "10000": {
                                createEnemy({type: "shooter", ai: "shoot", x: eX, y: eY, health: 30000, acc: 15, maxSpeed: 25, size: 30, hitDamage: 6,
                                    delay: 2+Math.random(), shotSize: 80, shotDelay: 1.5, shotDamage: 20
                                });
                                points -= 20;
                                break;
                            }
                            case "15000": {
                                createEnemy({type: "shooter", ai: "shoot", x: eX, y: eY, health: 30000, acc: 15, maxSpeed: 25, size: 60, hitDamage: 6,
                                    delay: 0.75+Math.random()/40, shotSize: 30, shotDelay: 1.6, shotDamage: 5
                                });
                                points -= 30;
                                break;
                            }
                            case "20000": {
                                createEnemy({type: "medium", ai: "dash", dashDist: 0, dashDelay: 1,  x: eX, y: eY, health: 200000, acc: 10, maxSpeed: 8, size: 220, hitDamage: 20});
                                points -= 40;
                                break;
                            }
                        }
                    }
                }
            }
        }

        function createEnemy(spawnStats) {
            if (!spawnStats.x) spawnStats.x = 0;
            if (!spawnStats.y) spawnStats.y = 0;
            if (!spawnStats.speed) spawnStats.speed = 1/1000;
            if (!spawnStats.acc) spawnStats.acc = 20;
            if (!spawnStats.maxSpeed) spawnStats.maxSpeed = 8;
            if (!spawnStats.dir) spawnStats.dir = Math.atan((spawnStats.x-player.x)/(spawnStats.y-player.y)) + Math.PI*(spawnStats.y<player.y);
            if (!spawnStats.size) spawnStats.size = 20;
            if (!spawnStats.health) spawnStats.health = 10;
            if (!spawnStats.healthMax) spawnStats.healthMax = spawnStats.health;
            if (!spawnStats.hitDamage) spawnStats.hitDamage = 5;
            if (!spawnStats.ai) spawnStats.ai = "orbit";
            if (!spawnStats.type) spawnStats.type = "small";
            if (!spawnStats.shootTick && spawnStats.ai == "shoot") spawnStats.shootTick = spawnStats.delay * game.fps + Math.ceil(Math.random()*10);
            spawnStats.dmgThisFrame = 0;
            spawnStats.spawning = true;

            spawnStats.health *= 1.025**1.025**waveNum;
            enemyBuffer.push(spawnStats);
        }

        function enemytickLoop() {
            enemys.push(...enemyBuffer);
            enemyBuffer = [];
            enemys.forEach(
                (enemy, i) => { if (enemy) {
                    alive = true;

                    if (Number.isNaN(enemy.x + enemy.y + enemy.dir)) alive = false;

                    if (enemy.spawning) {
                            if (enemy.x-enemy.size/2 > 0 && enemy.x+enemy.size/2 < canvas.width && enemy.y-enemy.size/2 > 0 && enemy.y+enemy.size/2 < canvas.height) enemy.spawning = false;
                    }

                    var tickMove = {x: Math.sin(enemy.dir)*enemy.speed, y: Math.cos(enemy.dir)*enemy.speed}

                    if (enemy.spawning) {
                        ctx.beginPath();
                        ctx.strokeStyle = "#55000066";
                        ctx.fillStyle = "#aa000066";

                        ctx.rect( Math.min(canvas.width, Math.max(0, enemy.x-enemy.size/2)+enemy.size)-enemy.size - (enemy.size-10)*(enemy.x < enemy.size/2) + (enemy.size-10)*(enemy.x > canvas.width-enemy.size/2), 
                            Math.min(canvas.height, Math.max(0, enemy.y-enemy.size/2)+enemy.size)-enemy.size - (enemy.size-10)*(enemy.y < enemy.size/2) + (enemy.size-10)*(enemy.y > canvas.height-enemy.size/2), enemy.size, enemy.size);
                        
                        ctx.fill();
                        ctx.stroke();

                        tickMove.x *= 0.97;
                        tickMove.y *= 0.97;
                    } else {
                        //borders
                        if (enemy.x-enemy.size/2 < 0 && tickMove.x < 0 ) {
                            tickMove.x *= -1;
                            enemy.x = enemy.size/2;
                        } else if (enemy.x+enemy.size/2 > canvas.width && tickMove.x > 0 ) {
                            tickMove.x *= -1;
                            enemy.x = canvas.width-enemy.size/2;
                        }
                        if (enemy.y-enemy.size/2 < 0 && tickMove.y < 0 ) {
                            tickMove.y *= -1;
                            enemy.y = enemy.size/2;
                        } else if (enemy.y+enemy.size/2 > canvas.height && tickMove.y > 0 ) {
                            tickMove.y *= -1;
                            enemy.y = canvas.height-enemy.size/2;
                        }
                    }
                    draw("enemy", [{x: enemy.x, y: enemy.y, dir: enemy.dir, size: enemy.size, health: enemy.health, healthMax: enemy.healthMax, type: enemy.type}]);
                    
                    enemy.x += tickMove.x*60/game.fps;
                    enemy.y += tickMove.y*60/game.fps;
                    enemys.forEach((enemy2, i2) => { if (enemy2) {
                        if (i != i2) {
                            var dist = Math.hypot(enemy2.x-enemy.x, enemy2.y-enemy.y)-enemy.size/2 - enemy2.size/2 - 20;
                            if (dist < 0) {
                                var moveDir = 0;
                                if (enemy.x-enemy2.x != 0) moveDir = Math.atan((enemy.x-enemy2.x)/(enemy.y-enemy2.y)) + Math.PI*(enemy.y>enemy2.y);
                                tickMove.x += Math.sin(moveDir)/game.fps*dist;
                                tickMove.y += Math.cos(moveDir)/game.fps*dist;
                                enemy.speed = Math.hypot(tickMove.x, tickMove.y)*3;
                                if (tickMove.y != 0) enemy.dir = Math.atan(tickMove.x/tickMove.y) + Math.PI*(tickMove.y < 0);
                                if (enemy.speed > enemy.maxSpeed) enemy.speed = enemy.maxSpeed;
                            }
                        }
                    }});

                    if (enemy.ai == "orbit" || enemy.ai == "necroSword") {
                        var moveDir = 0;
                        moveDir = Math.atan( ( enemy.x-player.x-player.speed*game.fps*Math.sin(player.speedDir)/3 ) / ( enemy.y-player.y-player.speed*game.fps*Math.cos(player.speedDir)/3 ) ) + Math.PI*(enemy.y>player.y+player.speed*game.fps*Math.cos(player.speedDir)/3);    
                        tickMove.x += Math.sin(moveDir)*enemy.acc/game.fps;
                        tickMove.y += Math.cos(moveDir)*enemy.acc/game.fps;
                        enemy.speed = Math.hypot(tickMove.x, tickMove.y)
                        if (!enemy.frictionLess) enemy.speed *= (1-0.02*60/game.fps);//friction
                        if (tickMove.y != 0) enemy.dir = Math.atan(tickMove.x/tickMove.y) + Math.PI*(tickMove.y < 0);
                        if (enemy.speed > enemy.maxSpeed) enemy.speed = enemy.maxSpeed;
                    } else if (enemy.ai == "dash") {
                        tickMove.x += Math.sin(enemy.dashDir)*enemy.acc/game.fps;
                        tickMove.y += Math.cos(enemy.dashDir)*enemy.acc/game.fps;
                        enemy.speed = Math.hypot(tickMove.x, tickMove.y);
                        if ((!enemy.dashDist || enemy.dashDist < 0) && Math.hypot(player.x-enemy.x, player.y-enemy.y) > 200) {
                            if (enemy.y != player.y) enemy.dashDir = Math.atan((enemy.x-player.x-player.speed*game.fps*Math.sin(player.speedDir)/3)/(enemy.y-player.y-player.speed*game.fps*Math.cos(player.speedDir)/3)) + Math.PI*(enemy.y>player.y+player.speed*game.fps*Math.cos(player.speedDir)/3);
                            enemy.dashDist = Math.ceil(game.fps*enemy.dashDelay + game.fps*Math.random()*0.25);
                            enemy.dir = enemy.dashDir;
                            enemy.speed = 0;
                        } else enemy.dashDist--;
                        if (enemy.speed > enemy.maxSpeed*60/game.fps) enemy.speed = enemy.maxSpeed*60/game.fps;
                    } if (enemy.ai == "shoot") {
                        var moveDir = 0;
                        if (enemy.x-player.x != 0) moveDir = Math.atan((enemy.x-player.x)/(enemy.y-player.y)) + Math.PI*(enemy.y>player.y) + Math.PI/6;
                        tickMove.x += Math.sin(moveDir)*enemy.acc/game.fps;
                        tickMove.y += Math.cos(moveDir)*enemy.acc/game.fps;
                        enemy.speed = Math.hypot(tickMove.x, tickMove.y)*(1-0.02*60/game.fps);//friction
                        if (tickMove.y != 0) enemy.dir = Math.atan(tickMove.x/tickMove.y) + Math.PI*(tickMove.y < 0);
                        if (enemy.speed > enemy.maxSpeed) enemy.speed = enemy.maxSpeed;
                        //shoot
                        if ((!enemy.shootTick || enemy.shootTick < 0)) {
                            if (enemy.y != player.y) enemy.dashDir = Math.atan((enemy.x-player.x)/(enemy.y-player.y)) + Math.PI*(enemy.y>player.y);
                            enemy.shootTick = Math.ceil(game.fps*enemy.delay + game.fps*Math.random()*0.25);
                            createAttack({type: "explosion", delay: Math.floor(game.fps*enemy.shotDelay), delayMax: Math.floor(game.fps*enemy.shotDelay), x: player.x+player.speed*Math.sin(player.speedDir)*game.fps/2+Math.random()*300-150, y: player.y+player.speed*Math.cos(player.speedDir)*game.fps/2+Math.random()*300-150, size: enemy.shotSize, damage: enemy.shotDamage, origin: {x: enemy.x, y: enemy.y}});
                        } else enemy.shootTick--;
                    }
                    //bosses
                    if (enemy.ai == "necroSword") {
                        if (!enemy.spawnDelay || enemy.spawnDelay <= 0) {
                            enemy.spawnDelay = game.fps*5;
                            for (var i = 0; i < 5; i++) createEnemy({type: "sword", ai: "dash", dashDist: 0, dashDelay: 2, x: enemy.x+Math.random()*100-50, y: enemy.y+Math.random()*100-50, health: 30, acc: 10, maxSpeed: 20, size: 55, hitDamage: 15});
                        } else enemy.spawnDelay--;
                    }
                    
                    //effects
                    if (enemy.effects) {
                        //bloody scythe
                        if (enemy.effects.bSStacks && baseStats.bloodyScythe) {
                            if (Math.floor((game.tick+enemy.effects.bSOffset)%(game.fps/baseStats.bloodyScythe.tickRate)) == 0) {
                                enemy.health -= baseStats.bloodyScythe.damage*enemy.effects.bSStacks;
                                if (game.displayDmgNum) enemy.dmgThisFrame += baseStats.bloodyScythe.damage*enemy.effects.bSStacks;
                                createDrawInput({x: enemy.x, y: enemy.y, size: 10}, 0.1, "blood")
                            }
                        }
                        //cobra fang
                        if (enemy.effects.fangStacks) {
                            enemy.health -= enemy.effects.fangDamage/game.fps;
                            createDrawInput({x: enemy.x, y: enemy.y, size: 5}, 0.1, "blood1");
                            if (Math.floor((game.tick)%(game.fps/2)) == 0) {
                                if (game.displayDmgNum) enemy.dmgThisFrame += enemy.effects.fangDamage/2;
                            }
                        }
                    }

                    if (Math.hypot(player.x-enemy.x, player.y-enemy.y) <= (enemy.size/2 + baseStats.size*statMult.size)) {
                        var angle = Math.atan((enemy.x-player.x)/(enemy.y-player.y)) + Math.PI*(enemy.y>player.y);
                        if (player.iFrames <= 0) {
                            player.health -= enemy.hitDamage;
                            player.iFrames += baseStats.iFrames*statMult.iFrames;
                        }
                        enemy.dir += Math.PI - (enemy.dir-angle)*2;
                    }
                    if (enemy.health <= 0) alive = false;

                    if (!alive) {
                        enemys[i] = false;

                        createDrawInput({type: enemy.type, x: enemy.x, y: enemy.y, vx: enemy.speed*Math.sin(enemy.dir), vy: enemy.speed*Math.cos(enemy.dir), dir: enemy.dir, size: enemy.size}, 0.3, "enemy");
                        
                        if (Math.random() < baseStats.pickupChance/enemys.length) createPickup(enemy.x, enemy.y, "healthPickup");
                    }

                    if (game.displayDmgNum && enemy.dmgThisFrame) createDmgNum(enemy.x, enemy.y, enemy.dmgThisFrame, enemy.size+30);
                    if (enemy.dmgThisFrame > game.highestDamage && waveNum) game.highestDamage = enemy.dmgThisFrame;
                    enemy.dmgThisFrame = 0;

                    return true;
                } else return true;
            }); 
        }
        
        function createAttack(obj) {
            obj.framesLeft = Math.ceil(game.fps/4);
            attackInputs.push(obj);
        }

        function handleAttackInputs() {
            attackInputs.forEach((item) => {
                if (item.type == "explosion") {
                    draw("attack", [{x: item.x, y: item.y, origin: item.origin, size: item.size, delay: item.delay, delayMax: item.delayMax, type: "explosion"}]);

                    if (item.delay >= 0) item.delay--;
                    else {
                        item.size *= 0.8;
                        item.framesLeft--;
                    }
                    if (item.delay == 0) {
                        if (Math.hypot(player.x-item.x, player.y-item.y) < item.size+baseStats.size*statMult.size) player.health -= item.damage;
                        item.size *= 1.25;
                    } 
                }
            });

            attackInputs = attackInputs.filter((item) => item.framesLeft > 0);
        }

        //   ||===========================================||
        //   ||               V I S U A L S               ||
        //   ||===========================================||

        function draw(input, positions) {
            positions.forEach((item, i) => {
                if (item) {
                    ctx.beginPath();
                    switch(input){
                        case "background": {
                            //background
                            ctx.beginPath();
                            ctx.fillStyle = "#cccccc";
                            if (game.motionBlur) ctx.fillStyle += "88";
                            ctx.fillRect(0, 0, canvas.width, canvas.height);
                            
                            ctx.save();
                            ctx.beginPath();
                            var gridSize = 100;
                            ctx.translate(canvas.width/2, canvas.height/2)
                            ctx.rotate(game.cursorRotation/8);
                            ctx.fillStyle = "#bbbbbb88";
                            for(var a = -200; a < canvas.width+200; a += gridSize) {
                                for(var b = -200; b < canvas.width+200; b += gridSize) {
                                    ctx.beginPath();
                                    ctx.moveTo(-(-2+game.cursorRotation%4)*10 + a - canvas.width/2, -20 + b - canvas.width/2);
                                    ctx.lineTo(20 + a - canvas.width/2, -(-2+game.cursorRotation%4)*10 + b - canvas.width/2);
                                    ctx.lineTo((-2+game.cursorRotation%4)*10 + a - canvas.width/2, 20 + b - canvas.width/2);
                                    ctx.lineTo(-20 + a - canvas.width/2, (-2+game.cursorRotation%4)*10 + b - canvas.width/2);
                                    ctx.closePath();
                                    ctx.fill();
                                }
                            }

                            ctx.restore();

                            break;
                        }
                        case "menu": {
                            //background
                            ctx.beginPath();
                            ctx.fillStyle = "#cccccc88";
                            ctx.fillRect(0, 0, canvas.width, canvas.height);

                            break;
                        }
                        case "cursor": {
                            //draw cursor
                            ctx.beginPath();
                            ctx.save();
                            ctx.translate(mouseX,mouseY);
                            ctx.rotate(game.cursorRotation);
                            ctx.fillStyle = "#555555";
                            ctx.strokeStyle = "#000000";
                            for(var i = 0; i < 3; i++) {
                                ctx.moveTo(0,-4);
                                ctx.lineTo(-8, -8);
                                ctx.lineTo(8, -8);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();
                                ctx.rotate(Math.PI/3*2);
                            }
                            ctx.restore();
                            if (game.fps > 1) game.cursorRotation += Math.PI / game.fps / 4;
                            break;
                        }
                        case "healthPickup": {
                            ctx.beginPath();
                            ctx.fillStyle = "#dd6666";
                            ctx.strokeStyle = "#000000";
                            ctx.moveTo(item.x-1*item.size,item.y-1*item.size);
                            ctx.lineTo(item.x-1*item.size,item.y-3*item.size);
                            ctx.lineTo(item.x+1*item.size,item.y-3*item.size);
                            ctx.lineTo(item.x+1*item.size,item.y-1*item.size);
                            ctx.lineTo(item.x+3*item.size,item.y-1*item.size);
                            ctx.lineTo(item.x+3*item.size,item.y+1*item.size);
                            ctx.lineTo(item.x+1*item.size,item.y+1*item.size);
                            ctx.lineTo(item.x+1*item.size,item.y+3*item.size);
                            ctx.lineTo(item.x-1*item.size,item.y+3*item.size);
                            ctx.lineTo(item.x-1*item.size,item.y+1*item.size);
                            ctx.lineTo(item.x-3*item.size,item.y+1*item.size);
                            ctx.lineTo(item.x-3*item.size,item.y-1*item.size);
                            ctx.closePath();
                            ctx.fill();
                            ctx.stroke();
                            break;
                        }
                        case "plus": {
                            ctx.beginPath();
                            ctx.fillStyle = "#66aa66";
                            ctx.strokeStyle = "#000000";
                            ctx.moveTo(item.x-1*item.size,item.y-1*item.size);
                            ctx.lineTo(item.x-1*item.size,item.y-3*item.size);
                            ctx.lineTo(item.x+1*item.size,item.y-3*item.size);
                            ctx.lineTo(item.x+1*item.size,item.y-1*item.size);
                            ctx.lineTo(item.x+3*item.size,item.y-1*item.size);
                            ctx.lineTo(item.x+3*item.size,item.y+1*item.size);
                            ctx.lineTo(item.x+1*item.size,item.y+1*item.size);
                            ctx.lineTo(item.x+1*item.size,item.y+3*item.size);
                            ctx.lineTo(item.x-1*item.size,item.y+3*item.size);
                            ctx.lineTo(item.x-1*item.size,item.y+1*item.size);
                            ctx.lineTo(item.x-3*item.size,item.y+1*item.size);
                            ctx.lineTo(item.x-3*item.size,item.y-1*item.size);
                            ctx.closePath();
                            ctx.fill();
                            ctx.stroke();
                            break;
                        }
                        case "UI": {
                            ctx.lineWidth += 3;
                            ctx.fillStyle = "#999999"
                            ctx.strokeStyle = "#000000";
                            ctx.beginPath();
                            ctx.fillStyle = "#990000";
                            ctx.moveTo(canvas.width/2-3*baseStats.healthMax*statMult.healthMax-50, canvas.height-10);
                            ctx.lineTo(canvas.width/2+3*baseStats.healthMax*statMult.healthMax+50, canvas.height-10);
                            ctx.lineTo(canvas.width/2+3*baseStats.healthMax*statMult.healthMax+20, canvas.height-30);
                            ctx.lineTo(canvas.width/2-3*baseStats.healthMax*statMult.healthMax-20, canvas.height-30);
                            ctx.closePath();
                            ctx.stroke();
                                
                            if (player.health > 0 ) {
                                ctx.beginPath();
                                ctx.moveTo(canvas.width/2-3*player.health-50, canvas.height-10);
                                ctx.lineTo(canvas.width/2+3*player.health+50, canvas.height-10);
                                ctx.lineTo(canvas.width/2+3*player.health+20, canvas.height-30);
                                ctx.lineTo(canvas.width/2-3*player.health-20, canvas.height-30);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();
                            }

                            ctx.beginPath();
                            ctx.fillStyle = "#666666"
                            ctx.moveTo(canvas.width/2-60, canvas.height);
                            ctx.lineTo(canvas.width/2, canvas.height-60);
                            ctx.lineTo(canvas.width/2+60, canvas.height);
                            ctx.closePath();
                            ctx.fill();
                            ctx.stroke();

                            if (game.displayFps) {
                                ctx.beginPath();
                                ctx.fillStyle = "#666666"
                                ctx.moveTo(0,canvas.height);
                                ctx.lineTo(0,canvas.height-35);
                                ctx.lineTo(70,canvas.height-35);
                                ctx.lineTo(100,canvas.height);
                                ctx.fill();
                                ctx.stroke();

                                ctx.beginPath();
                                ctx.font = "25px share tech";
                                ctx.fillStyle = "#ffffff99";
                                ctx.fillText(game.fps, 35,canvas.height-10);
                            }

                            if (game.displayWaveNum) {
                                ctx.beginPath();
                                ctx.fillStyle = "#666666"
                                ctx.moveTo(canvas.width,canvas.height);
                                ctx.lineTo(canvas.width,canvas.height-35);
                                ctx.lineTo(canvas.width-70,canvas.height-35);
                                ctx.lineTo(canvas.width-100,canvas.height);
                                ctx.fill();
                                ctx.stroke();

                                ctx.beginPath();
                                ctx.font = "25px share tech";
                                ctx.fillStyle = "#ffffff99";
                                ctx.fillText(Math.max(0,waveNum), canvas.width-35,canvas.height-10);
                            }

                            if (localStorage.getItem("tutorial") != "true") {
                                ctx.font = "50px share tech";
                                //WASD
                                ctx.beginPath();
                                ctx.fillStyle = "#00000044";
                                ctx.arc(canvas.width/4-100, 200, 30, Math.PI, -Math.PI/2);
                                ctx.arc(canvas.width/4+200, 200, 30, -Math.PI/2, 0);
                                ctx.arc(canvas.width/4+200, 400, 30, 0, Math.PI/2);
                                ctx.arc(canvas.width/4-100, 400, 30, Math.PI/2, Math.PI);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();

                                ctx.beginPath();
                                ctx.fillStyle = "#00000099";
                                ctx.rect(canvas.width/4+10, 210, 80, 80);
                                ctx.rect(canvas.width/4-90, 310, 80, 80);
                                ctx.rect(canvas.width/4+10, 310, 80, 80);
                                ctx.rect(canvas.width/4+110, 310, 80, 80);
                                ctx.fill();
                                ctx.stroke();

                                ctx.beginPath();
                                ctx.fillStyle = "#ffffff99";
                                ctx.fillText("W", canvas.width/4+50, 270);
                                ctx.fillText("A", canvas.width/4-50, 370);
                                ctx.fillText("S", canvas.width/4+50, 370);
                                ctx.fillText("D", canvas.width/4+150, 370);

                                //Mouse
                                ctx.beginPath();
                                ctx.fillStyle = "#00000044";
                                ctx.arc(canvas.width/4*3-200, 200, 30, Math.PI, -Math.PI/2);
                                ctx.arc(canvas.width/4*3, 200, 30, -Math.PI/2, 0);
                                ctx.arc(canvas.width/4*3, 400, 30, 0, Math.PI/2);
                                ctx.arc(canvas.width/4*3-200, 400, 30, Math.PI/2, Math.PI);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();

                                ctx.beginPath();
                                ctx.fillStyle = "#00000099";
                                ctx.moveTo(canvas.width/4*3-100, 285);
                                ctx.lineTo(canvas.width/4*3-150, 285);
                                ctx.arc(canvas.width/4*3-100, 275, 50, Math.PI, -Math.PI/2);
                                ctx.fill();

                                ctx.beginPath();
                                ctx.fillStyle = "#00000066";
                                ctx.arc(canvas.width/4*3-100, 275, 50, Math.PI, 0);
                                ctx.arc(canvas.width/4*3-100, 325, 50, 0, Math.PI);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();
                            }

                            ctx.lineWidth -= 3;

                            return;
                        }
                        case "player": {
                            ctx.fillStyle = "#666666";
                            if (player.iFrames > 0) ctx.fillStyle += "99";
                            ctx.strokeStyle = "#000000";

                            var gap = 5;

                            if (item.rotate) player.drawRotation += Math.PI/8/game.fps;

                            ctx.save();
                            ctx.translate(item.x, item.y);
                            ctx.rotate(player.drawRotation);

                            ctx.beginPath();
                            ctx.moveTo(0-gap,0);
                            ctx.lineTo(0-item.size, 0-item.size+gap);
                            ctx.lineTo(0-item.size, 0+item.size-gap);
                            ctx.closePath();
                            ctx.fill();
                            ctx.stroke();

                            ctx.beginPath();
                            ctx.moveTo(0+gap,0);
                            ctx.lineTo(0+item.size, 0-item.size+gap);
                            ctx.lineTo(0+item.size, 0+item.size-gap);
                            ctx.closePath();
                            ctx.fill();
                            ctx.stroke();

                            ctx.beginPath();
                            ctx.moveTo(0,0-gap);
                            ctx.lineTo(0-item.size+gap, 0-item.size);
                            ctx.lineTo(0+item.size-gap, 0-item.size);
                            ctx.closePath();
                            ctx.fill();
                            ctx.stroke();

                            ctx.beginPath();
                            ctx.moveTo(0,0+gap);
                            ctx.lineTo(0-item.size+gap, 0+item.size);
                            ctx.lineTo(0+item.size-gap, 0+item.size);
                            ctx.closePath();
                            ctx.fill();
                            ctx.stroke();

                            ctx.restore();

                            return;
                        }
                        case "bullet": {
                            ctx.save();
                            ctx.translate(item.x, item.y);
                            ctx.rotate(-item.dir+Math.PI/2);
                            
                            bulletImage(item, i);

                            ctx.restore();
                            
                            return;
                        }
                        case "enemy": {
                            ctx.save();
                            ctx.translate(item.x, item.y);

                            enemyImage(item, i);

                            ctx.restore();
                            
                            if (item.type == "necroSword" || item.type == "bigSword" || item.type == "shooterBossFinale" || item.type == "BigBoi") {
                                ctx.lineWidth += 3;
                                ctx.fillStyle = "#999999"
                                ctx.strokeStyle = "#000000";
                                ctx.beginPath();
                                ctx.fillStyle = "#990000";
                                ctx.moveTo(0, 10);
                                ctx.lineTo((canvas.width-100)+50, 10);
                                ctx.lineTo((canvas.width-100)+20, 30);
                                ctx.lineTo(0, 30);
                                ctx.closePath();
                                ctx.stroke();
                                    
                                if (item.health > 0 ) {
                                    ctx.beginPath();
                                    ctx.moveTo(0, 10);
                                    ctx.lineTo(item.health/item.healthMax*(canvas.width-100)+50, 10);
                                    ctx.lineTo(item.health/item.healthMax*(canvas.width-100)+20, 30);
                                    ctx.lineTo(0, 30);
                                    ctx.closePath();
                                    ctx.fill();
                                    ctx.stroke();
                                }

                                ctx.beginPath();
                                ctx.fillStyle = "#666666"
                                ctx.moveTo(0, 60);
                                ctx.lineTo(60, 0);
                                ctx.lineTo(0, 0);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();

                                ctx.lineWidth -= 3;
                            } else if (item.type == "shooterBoss" || item.type == "shooterBoss2") {
                                ctx.lineWidth += 3;
                                ctx.fillStyle = "#999999"
                                ctx.strokeStyle = "#000000";
                                ctx.beginPath();
                                ctx.fillStyle = "#990000";
                                ctx.moveTo(0, 10);
                                ctx.lineTo((canvas.width-100)+50, 10);
                                ctx.lineTo((canvas.width-100)+20, 30);
                                ctx.lineTo(0, 30);
                                ctx.closePath();
                                ctx.stroke();
                                    
                                if (item.health > 0 ) {
                                    if (item.type == "shooterBoss2") {
                                        ctx.beginPath();
                                        ctx.moveTo(0, 10);
                                        ctx.lineTo(item.health/item.healthMax*(canvas.width/2-50)+50, 10);
                                        ctx.lineTo(item.health/item.healthMax*(canvas.width/2-50)+20, 30);
                                        ctx.lineTo(0, 30);
                                        ctx.closePath();
                                        ctx.fill();
                                        ctx.stroke();
                                    } else {
                                        ctx.beginPath();
                                        ctx.moveTo(canvas.width/2-50, 10);
                                        ctx.lineTo(canvas.width/2-50+item.health/item.healthMax*(canvas.width/2-50)+50, 10);
                                        ctx.lineTo(canvas.width/2-50+item.health/item.healthMax*(canvas.width/2-50)+20, 30);
                                        ctx.lineTo(canvas.width/2-50, 30);
                                        ctx.closePath();
                                        ctx.fill();
                                        ctx.stroke();
                                    }
                                }

                                ctx.beginPath();
                                ctx.fillStyle = "#666666"
                                ctx.moveTo(0, 60);
                                ctx.lineTo(60, 0);
                                ctx.lineTo(0, 0);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();

                                ctx.lineWidth -= 3;
                            }else if (item.health < item.healthMax && item.health > 0) {
                                ctx.lineWidth -= 1;

                                ctx.beginPath();
                                ctx.strokeStyle = "#000000";
                                ctx.fillStyle = "#999999";
                                ctx.rect(item.x - 10 - item.size/2, item.y - 20-item.size/2, 20 + item.size, 10);
                                ctx.fill();
                                ctx.stroke();

                                ctx.beginPath();
                                ctx.fillStyle = "#990000";
                                ctx.rect(item.x - (item.health/item.healthMax)*(10 + item.size/2), item.y - 20-item.size/2, (item.health/item.healthMax)*(20 + item.size), 10);
                                ctx.fill();
                                ctx.stroke();
                                
                                ctx.lineWidth += 1;
                            }
                            return;
                        }
                        case "attack": {
                            ctx.save();
                            ctx.translate(item.x, item.y);
                            ctx.rotate(item.dir);

                            var ODiff = {x: item.origin.x-item.x, y: item.origin.y-item.y};

                            if (item.delay > 0) {
                                ctx.beginPath();
                                ctx.strokeStyle = "#ff000030";
                                ctx.moveTo(ODiff.x*item.delay/item.delayMax, ODiff.y*item.delay/item.delayMax);
                                ctx.lineTo(ODiff.x*item.delay/item.delayMax*0.8, ODiff.y*item.delay/item.delayMax*0.8);
                                ctx.lineWidth += 5;
                                ctx.stroke();
                                ctx.lineWidth -= 5;
                            }

                            ctx.strokeStyle = "#000000";
                            for(var i = 0; i < 2; i++) {
                                ctx.beginPath();
                                ctx.fillStyle = "#ff000055";
                                if (item.delay <= 0) ctx.fillStyle = "#ff000099";
                                ctx.moveTo(0,item.size);
                                ctx.lineTo(item.size/1.4, item.size/1.4); //1.4 == sqrt(2)
                                ctx.lineTo(item.size, 0);
                                ctx.lineTo(item.size/1.4, -item.size/1.4);
                                ctx.lineTo(0, -item.size);
                                ctx.lineTo(-item.size/1.4, -item.size/1.4);
                                ctx.lineTo(-item.size, 0);
                                ctx.lineTo(-item.size/1.4, item.size/1.4);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();

                                ctx.scale((item.delayMax-item.delay)/item.delayMax, (item.delayMax-item.delay)/item.delayMax)
                            }

                            ctx.restore();
                            
                            return;
                        }
                        case "upgrades": {
                            var upgradeX = i*(canvas.width/positions.length) + (canvas.width/(positions.length*2));
                            var upgradeY = 250;

                            upgradeImage(upgradeX, upgradeY, 0, item.name);

                            if (game.select == i) {
                                let name = item.name;
                                let sub = item.subText;
                                let desc = item.description;


                                ctx.strokeStyle = "#000000";
                                ctx.lineWidth += 5
                                for (var i = 0; i < 8; i++) {
                                    ctx.beginPath();
                                    ctx.arc(upgradeX, upgradeY, 95, game.cursorRotation+i*Math.PI/4, game.cursorRotation+Math.PI/8+i*Math.PI/4);
                                    ctx.stroke();
                                }
                                ctx.lineWidth -= 5

                                upgradeX = canvas.width/4;
                                ctx.beginPath();
                                ctx.fillStyle = "#444444";
                                ctx.strokeStyle = "#000000";
                                ctx.arc(upgradeX-150, upgradeY+600, 50, Math.PI, Math.PI/2, true);
                                ctx.arc(upgradeX+150, upgradeY+600, 50, Math.PI/2, 0, true);
                                ctx.arc(upgradeX+150, upgradeY+200, 50, 0, -Math.PI/2, true);
                                ctx.arc(upgradeX-150, upgradeY+200, 50, -Math.PI/2, Math.PI, true);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();

                                ctx.beginPath();
                                ctx.fillStyle = "#444444";
                                ctx.strokeStyle = "#000000";
                                ctx.arc(upgradeX+350, upgradeY+600, 50, Math.PI, Math.PI/2, true);
                                ctx.arc(upgradeX+1050, upgradeY+600, 50, Math.PI/2, 0, true);
                                ctx.arc(upgradeX+1050, upgradeY+200, 50, 0, -Math.PI/2, true);
                                ctx.arc(upgradeX+350, upgradeY+200, 50, -Math.PI/2, Math.PI, true);
                                ctx.closePath();
                                ctx.fill();
                                ctx.stroke();

                                if (item.children) {
                                    let x = canvas.width/16*7.5;
                                    let y = upgradeY+400;
                                    if (item.children.length > 1) {
                                        y -= 200/(item.children.length)*(item.children.length-1);
                                    }
                                    item.children.forEach((item2, i2) => {
                                        ctx.beginPath();
                                        ctx.moveTo(upgradeX+350, upgradeY+400);
                                        ctx.lineTo(x-40,y);
                                        ctx.stroke();

                                        ctx.beginPath();
                                        ctx.fillStyle = "#ffffff55";
                                        ctx.arc(x,y,40, 0,Math.PI*2);
                                        ctx.fill();
                                        ctx.stroke();

                                        draw("plus", [{x: x, y: y, size: 8}]);

                                        if (Math.hypot(mouseX - x, mouseY - y) < 50) {
                                            name = item2.name;
                                            sub = item2.subText;
                                            desc = item2.description;

                                            ctx.strokeStyle = "#000000";
                                            ctx.lineWidth += 5
                                            for (var i = 0; i < 8; i++) {
                                                ctx.beginPath();
                                                ctx.arc(x, y, 55, game.cursorRotation+i*Math.PI/4, game.cursorRotation+Math.PI/8+i*Math.PI/4);
                                                ctx.stroke();
                                            }
                                            ctx.lineWidth -= 5
                                        }

                                        if (item2.children) {
                                            let x2 = canvas.width/16*9.5;
                                            let y2 = y;
                                            if (item2.children.length > 1) {
                                                y2 -= 100/(item2.children.length)*(item2.children.length-1);;
                                            }
                                            if (item.children.length > 1) {
                                                if (i2 < (item.children.length-1)/2) {
                                                    y2 -= 20;
                                                } else y2 += 20;
                                            }
                                            item2.children.forEach((item3, i3) => {
                                            ctx.beginPath();
                                            ctx.moveTo(x+40, y);
                                            ctx.lineTo(x2-40,y2);
                                            ctx.stroke();

                                            ctx.beginPath();
                                            ctx.fillStyle = "#ffffff55";
                                            ctx.arc(x2,y2,40, 0,Math.PI*2);
                                            ctx.fill();
                                            ctx.stroke();

                                            draw("plus", [{x: x2, y: y2, size: 8}]);

                                            if (Math.hypot(mouseX - x2, mouseY - y2) < 50) {
                                                name = item3.name;
                                                sub = item3.subText;
                                                desc = item3.description;

                                                ctx.strokeStyle = "#000000";
                                                ctx.lineWidth += 5
                                                for (var i = 0; i < 8; i++) {
                                                    ctx.beginPath();
                                                    ctx.arc(x2, y2, 55, game.cursorRotation+i*Math.PI/4, game.cursorRotation+Math.PI/8+i*Math.PI/4);
                                                    ctx.stroke();
                                                }
                                                ctx.lineWidth -= 5
                                            }

                                            y2 += 100/(item2.children.length-1);
                                        });
                                        }

                                        y += 200/(item.children.length-1);
                                    });
                                } else {
                                    ctx.save();
                                    ctx.beginPath();
                                    ctx.translate(upgradeX+750, upgradeY+400);
                                    ctx.rotate(-Math.PI/8);
                                    
                                    ctx.font = "150px share tech";
                                    ctx.fillStyle = "#ffffffcc";
                                    ctx.fillText("NONE!", 0,0);

                                    ctx.restore();
                                }

                                ctx.lineWidth -= 2;
                                ctx.beginPath();
                                ctx.fillStyle = "#d0d0d0";
                                ctx.font = "45px share tech";
                                ctx.fillText(name, upgradeX, upgradeY+210);
                                ctx.font = "25px share tech";
                                ctx.fillText(sub, upgradeX, upgradeY+240);

                                ctx.font = "30px share tech";
                                desc.forEach((item, i) => { ctx.fillText(item, upgradeX, upgradeY+300+35*i) });
                                ctx.lineWidth += 2;
                            }

                            return;
                        }
                    }
                }
            });
        }
        
        function drawEverything(func) {
            draw("background", [{}]);
            draw("UI", [{}]);
            draw("player", [{x: player.x, y: player.y, size: baseStats.size*statMult.size, rotate: false}]);
            if (game.menu !== "main") upgradeImage(player.x, player.y, 60, baseStats.weapon, player.lastAimDir, player.lastAimFlip, 0.5);
            draw("enemy", enemys);
            draw("bullet", bullets);
            draw("attack", attackInputs);
            draw("menu", [{}]);

            func();

            draw("cursor", [{}]);
        }

        function createDmgNum(x, y, dmg, offset) {
            const seconds = 0.5;
            const size = Math.min(500, Math.max(30, dmg/(waveNum+1)*10) );
            dmgNumbers.push({
                x: Math.max(size, Math.min(canvas.width-size, x)), y: Math.max(size, Math.min(canvas.height-size, y)), damage: Math.ceil(dmg*10)/10, framesLeft: Math.ceil(game.fps*seconds), size: size, angle: Math.PI/2*Math.random()- Math.PI/4, offset: offset
            });
        }

        function handleDmgNums() {
            const lW = ctx.lineWidth;
            ctx.fillStyle = "#000";
            ctx.strokeStyle = "#fff";

            dmgNumbers.forEach((item) => {
                ctx.save();
                ctx.beginPath();
                ctx.translate(item.x, Math.max(item.size, item.y-item.offset)+item.offset);
                ctx.rotate(item.angle);
                ctx.font = Math.floor(item.size) + "px share tech";
                ctx.lineWidth = item.size/100;
                ctx.strokeText(item.damage, 0, -item.offset);
                ctx.fillText(item.damage, 0, -item.offset);
                ctx.restore();

                item.framesLeft--;

                item.size *= 1-(2/game.fps);
            });

            dmgNumbers = dmgNumbers.filter((item) => item.framesLeft > 0);

            ctx.lineWidth = lW;
        }

        function createDrawInput(obj, seconds, type) {
            drawInputs.push({
                obj: obj, framesLeft: Math.ceil(game.fps*seconds), type: type
            });
        }

        function handleDrawInputs() {
            drawInputs.forEach((item) => {
                item.framesLeft--;

                if (item.type == "scanner ray") {
                    ctx.lineWidth += item.obj.size;
                    ctx.lineWidth += 4;
                    ctx.beginPath();
                    ctx.strokeStyle = "#00000055";
                    ctx.moveTo(item.obj.start.x, item.obj.start.y);
                    ctx.lineTo(item.obj.x, item.obj.y)
                    ctx.stroke();

                    ctx.lineWidth -= 4;
                    ctx.beginPath();
                    ctx.strokeStyle = "#ffff6699";
                    ctx.moveTo(item.obj.start.x, item.obj.start.y);
                    ctx.lineTo(item.obj.x, item.obj.y)
                    ctx.stroke();
                    
                    ctx.lineWidth -= item.obj.size;

                    item.obj.size *= 0.6;
                } else if (item.type == "blood" || item.type == "blood1") {
                    ctx.beginPath();
                    ctx.strokeStyle = "#000000";
                    if (item.type == "blood") ctx.fillStyle = "#990000";
                    else if (item.type == "blood1")ctx.fillStyle = "#009900";
                    ctx.arc(item.obj.x-item.obj.size, item.obj.y-item.obj.size*1.75, item.obj.size, 0, Math.PI/4);
                    ctx.arc(item.obj.x, item.obj.y, item.obj.size, -Math.PI/4*3, -Math.PI/4, true);
                    ctx.arc(item.obj.x+item.obj.size, item.obj.y-item.obj.size*1.75, item.obj.size, Math.PI/4*3, Math.PI);
                    ctx.fill();
                    ctx.stroke();

                    item.obj.size *= 0.8;
                } else if (item.type == "overflow") {
                    ctx.beginPath();
                    ctx.fillStyle = "#55555510";
                    ctx.strokeStyle = "#00000044";
                    ctx.arc(item.obj.x,item.obj.y,item.obj.size, 0, Math.PI*2);
                    ctx.fill();
                    ctx.stroke();

                    item.obj.size *= 0.8;
                } else {
                    draw(item.type, [item.obj]);

                    item.obj.size *= 0.8;
                }

                if (item.obj.vx && item.obj.vy) {
                    item.obj.x += item.obj.vx;
                    item.obj.y += item.obj.vy;
                }
            });

            drawInputs = drawInputs.filter((item) => item.framesLeft > 0);
        }

        function bulletImage(item, i) {
            ctx.beginPath();
            ctx.strokeStyle = "#000";
            switch (item.type) {
                case "Gatling Gun": {
                    ctx.beginPath();
                    ctx.fillStyle = "#666666";
                    ctx.strokeStyle = "#000000";
                    ctx.rect(-item.size/2*3, -item.size/2, item.size*3, item.size);
                    ctx.fill();
                    ctx.stroke();

                    return;
                }
                case "Floor Cannon": {
                    ctx.rotate(Math.PI/4);
                    ctx.beginPath();
                    ctx.fillStyle = "#999999";
                    ctx.strokeStyle = "#000000";
                    ctx.rect(-item.size/2, -item.size/2, item.size, item.size);
                    ctx.fill();
                    ctx.stroke();
                    ctx.rotate(Math.PI/4);
                    ctx.beginPath();
                    ctx.rect(-item.size/2, -item.size/2, item.size, item.size);
                    ctx.fill();
                    ctx.stroke();

                    return;
                }
                case "Rod Railgun": {   
                    ctx.beginPath();
                    ctx.fillStyle = "#22ccff";
                    ctx.strokeStyle = "#000000";
                    ctx.moveTo(item.size/2*3, -item.size/2-1);
                    ctx.lineTo(item.size/2*3+item.size/2+2, 0);
                    ctx.lineTo(item.size/2*3, item.size/2+1);
                    ctx.lineTo(-item.size/2*3+item.size/2, item.size/2);
                    ctx.lineTo(-item.size/2*3, 0);
                    ctx.lineTo(-item.size/2*3+item.size/2, -item.size/2);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();

                    return;
                }
                case "Gas Tank": {
                    ctx.rotate(item.dir - Math.PI/2);

                    ctx.beginPath();
                    ctx.fillStyle = "#c02222";
                    ctx.strokeStyle = "#000000";
                    ctx.arc(-item.size*1,-item.size*1.11, item.size, 0, 0.84);
                    ctx.arc(0,0, item.size/2, -Math.PI/4*3, -Math.PI/4, true);
                    ctx.arc(item.size*1,-item.size*1.11, item.size, Math.PI-0.84, Math.PI);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();

                    ctx.rotate(Math.random()/2-0.25);

                    ctx.beginPath();
                    ctx.fillStyle = "#ff6a00";
                    ctx.arc(-item.size*0.25,-item.size*0.2775, item.size/4, 0, 0.84);
                    ctx.arc(0,0, item.size/8, -Math.PI/4*3, -Math.PI/4, true);
                    ctx.arc(item.size*0.25,-item.size*0.2775, item.size/4, Math.PI-0.84, Math.PI);
                    ctx.closePath();
                    ctx.fill();

                    return;
                }
                case "War Comb": {
                    ctx.fillStyle = "#58f";
                    ctx.beginPath();
                    ctx.moveTo(-item.size/2, -item.size/4);
                    ctx.lineTo(item.size/2, -item.size/6);
                    ctx.lineTo(item.size/2, item.size/6);
                    ctx.lineTo(-item.size/2, item.size/4);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();

                    return;
                }
                case "Rubber Ball": {
                    ctx.beginPath();
                    ctx.fillStyle = "#c0c";
                    ctx.strokeStyle = "#000000";
                    ctx.moveTo(-item.size/2, 0);
                    ctx.lineTo(-item.size/2/1.41, -item.size/2/1.41);
                    ctx.lineTo(0, -item.size/2);
                    ctx.lineTo(item.size/2/1.41, -item.size/2/1.41);
                    ctx.lineTo(item.size/2, 0);
                    ctx.lineTo(item.size/2/1.41, item.size/2/1.41);
                    ctx.lineTo(0, item.size/2);
                    ctx.lineTo(-item.size/2/1.41, item.size/2/1.41);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();

                    return;
                }
                case "Honed Katana": {
                    ctx.fillStyle = "#ffffff80";
                    ctx.beginPath();
                    ctx.moveTo( item.size/3, 0 );
                    ctx.lineTo( item.size/3/1.41, -item.size/3/1.41 );
                    ctx.lineTo( 0, -item.size/2 );
                    ctx.lineTo( item.size/2/1.41, -item.size/2/1.41 );
                    ctx.lineTo( item.size/2, 0 );
                    ctx.lineTo( item.size/2/1.41, item.size/2/1.41 );
                    ctx.lineTo( 0, item.size/2 );
                    ctx.lineTo( item.size/3/1.41, item.size/3/1.41 );
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();

                    return;
                }
                case "High Decibal": {
                    ctx.fillStyle = "#0000ff44";
                    ctx.strokeStyle = "#000000";
                    ctx.beginPath();
                    ctx.moveTo( (item.size/2-20), 0 );
                    ctx.lineTo( (item.size/2-20)/1.41, -(item.size/2-20) );
                    ctx.lineTo( item.size/2/1.41, -item.size/2 );
                    ctx.lineTo( item.size/2, 0 );
                    ctx.lineTo( item.size/2/1.41, item.size/2 );
                    ctx.lineTo( (item.size/2-20)/1.41, (item.size/2-20) );
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();

                    return;
                }
                case "explosion": {
                    ctx.rotate(Math.PI/4);
                    ctx.fillStyle = "#ffff8877";
                    ctx.strokeStyle = "#000000";
                    ctx.rect(-item.size/2, -item.size/2, item.size, item.size);
                    ctx.fill();
                    ctx.stroke();

                    return;
                }
                default: { 
                    ctx.rotate(Math.PI/4);
                    ctx.fillStyle = "#666666";
                    ctx.strokeStyle = "#000000";
                    ctx.rect(-item.size/2, -item.size/2, item.size, item.size);
                    ctx.fill();
                    ctx.stroke();

                    return;
                }
            }
        }
        
        function enemyImage(item, i) {
            switch (item.type) {
                case "tiny": {
                    ctx.beginPath();
                    ctx.strokeStyle = "#000000";
                    ctx.fillStyle = "#990000";
                    ctx.rect(-item.size/2, -item.size/2, item.size, item.size);
                    ctx.fill();
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.rotate(Math.PI/4);
                    ctx.rect(-item.size/2, -item.size/2, item.size, item.size);
                    ctx.fill();
                    ctx.stroke();

                    return;
                }
                case "medium": {
                    ctx.beginPath();
                    ctx.strokeStyle = "#000000";
                    ctx.fillStyle = "#990000";
                    ctx.moveTo(item.size/2, 0);
                    ctx.lineTo(item.size/2, -item.size/2);
                    ctx.lineTo(-item.size/2, -item.size/2);
                    ctx.lineTo(-item.size/2, 0);
                    ctx.arc(0, 0, item.size/2, Math.PI, 0, true);
                    ctx.fill();
                    ctx.stroke();

                    return;
                }
                case "shooter": {
                    ctx.beginPath();
                    ctx.strokeStyle = "#000000";
                    ctx.fillStyle = "#990000";
                    var tempSize = 10;
                    if (item.size > 10) tempSize = item.size;

                    ctx.arc(5,5, tempSize/2-5, 0, Math.PI/2);
                    ctx.arc(-5,5, tempSize/2-5, Math.PI/2, Math.PI);
                    ctx.arc(-5,-5, tempSize/2-5, Math.PI, -Math.PI/2);
                    ctx.arc(5,-5, tempSize/2-5, -Math.PI/2, 0);
                    ctx.closePath();

                    ctx.fill();
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.strokeStyle = "#000000";
                    ctx.fillStyle = "#009999";

                    ctx.rotate(Math.PI/3);

                    ctx.rect(-tempSize/4, -tempSize/4, tempSize/2, tempSize/2);

                    ctx.fill();
                    ctx.stroke();

                    return;
                }
                case "shooterBoss": {
                    ctx.beginPath();
                    ctx.strokeStyle = "#000000";
                    ctx.fillStyle = "#990000";
                    var tempSize = 10;
                    if (item.size > 10) tempSize = item.size;

                    ctx.arc(5,5, tempSize/2-5, 0, Math.PI/2);
                    ctx.arc(-5,5, tempSize/2-5, Math.PI/2, Math.PI);
                    ctx.arc(-5,-5, tempSize/2-5, Math.PI, -Math.PI/2);
                    ctx.arc(5,-5, tempSize/2-5, -Math.PI/2, 0);
                    ctx.closePath();

                    ctx.fill();
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.strokeStyle = "#000000";
                    ctx.fillStyle = "#009999";
                    ctx.rotate(Math.PI/3);

                    ctx.rect(-tempSize/4, -tempSize/4, tempSize/2, tempSize/2);

                    ctx.fill();
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.rotate(Math.PI/3);

                    ctx.rect(-tempSize/8, -tempSize/8, tempSize/4, tempSize/4);

                    ctx.fill();
                    ctx.stroke();

                    return;
                }
                case "shooterBoss2": {
                    enemyImage({type: "shooterBoss", size: item.size}, i);
                    return;
                }
                case "shooterBossFinale": {
                    enemyImage({type: "shooterBoss", size: item.size}, i);
                    return;
                }
                case "sword": {
                    ctx.rotate(-item.dir+Math.PI);

                    ctx.beginPath();
                    ctx.strokeStyle = "#000000";
                    ctx.fillStyle = "#990000";
                    ctx.moveTo(0, -item.size/2-5);
                    ctx.lineTo(5, -item.size/2);
                    ctx.lineTo(5, 0);
                    ctx.lineTo(-5, 0);
                    ctx.lineTo(-5, -item.size/2);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(15, 0);
                    ctx.lineTo(10, 5);
                    ctx.lineTo(-10, 5);
                    ctx.lineTo(-15, 0);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(5, 5);
                    ctx.lineTo(5, item.size/4+5);
                    ctx.lineTo(0, item.size/4+10);
                    ctx.lineTo(-5, item.size/4+5);
                    ctx.lineTo(-5, 5);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();

                    return;
                }
                case "bigSword": {
                    ctx.rotate(-item.dir+Math.PI);
                    ctx.strokeStyle = "#000000";
                    ctx.fillStyle = "#990000";

                    ctx.beginPath();
                    ctx.moveTo(0, -item.size/2-5);
                    ctx.lineTo(10, -item.size/2);
                    ctx.lineTo(10, 0);
                    ctx.lineTo(-10, 0);
                    ctx.lineTo(-10, -item.size/2);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.strokeStyle = "#000000";
                    ctx.fillStyle = "#990000";
                    ctx.moveTo(0, -item.size-5);
                    ctx.lineTo(5, -item.size);
                    ctx.lineTo(5, 0);
                    ctx.lineTo(-5, 0);
                    ctx.lineTo(-5, -item.size);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(25, 0);
                    ctx.lineTo(20, 5);
                    ctx.lineTo(-20, 5);
                    ctx.lineTo(-25, 0);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(10, 5);
                    ctx.lineTo(10, item.size/4+5);
                    ctx.lineTo(0, item.size/4+10);
                    ctx.lineTo(-10, item.size/4+5);
                    ctx.lineTo(-10, 5);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();

                    return;
                }
                case "necroSword": {
                    enemyImage({size: item.size-20, dir: item.dir + Math.PI/6, type: "sword"});
                    enemyImage({size: item.size-20, dir: -Math.PI - Math.PI/3, type: "sword"});
                    enemyImage({size: item.size+30, dir: -Math.PI + Math.PI/6, type: "sword"});

                    return;
                }
                case "necroSwordEnemy": {
                    enemyImage({size: item.size-20, dir: item.dir + Math.PI/6, type: "sword"});
                    enemyImage({size: item.size-20, dir: -Math.PI - Math.PI/3, type: "sword"});
                    enemyImage({size: item.size+30, dir: -Math.PI + Math.PI/6, type: "sword"});

                    return;
                }
                default: { 

                    ctx.beginPath();
                    ctx.strokeStyle = "#000000";
                    ctx.fillStyle = "#990000";
                    ctx.rect(-item.size/2, -item.size/2, item.size, item.size);
                    ctx.fill();
                    ctx.stroke();

                    return;
                }
            }
        }

        function upgradeImage(x, y, offset, name, angle, flip, scale) {
            ctx.save();
            ctx.translate(x,y);
            if (flip) {
                ctx.scale(-scale, scale);
            } else if (scale) {
                ctx.scale(scale, scale);
            }
            if (angle) {
                if (flip) ctx.rotate(-angle+Math.PI);
                else ctx.rotate(angle);
            }
            ctx.translate(offset/scale,0);

            if (name[name.length-1] == "+") {
                draw("plus", [{x: 45, y: 45, size: 5}]);
            }

            //     |----------------------------------------------|
            //     |                   Weapons                    |
            //     |----------------------------------------------|
            if (name == "Gatling Gun" || name == "Gatling Gun+") {
                var leg = 20 * Math.sqrt(2);

                if (!angle) ctx.rotate(-Math.PI/6);

                ctx.beginPath();
                ctx.fillStyle = "#666666";
                ctx.rect(-40, -40, 10, 30);
                ctx.rect(-20, -40, 10, 30);
                ctx.rect(-10, -10, 75, 20);
                ctx.fill();
                ctx.stroke();

                ctx.beginPath();
                ctx.fillStyle = "#999999";
                ctx.strokeStyle = "#000000";
                ctx.rect(-50, -20, 40, 40);
                ctx.rect(-40, -40, 20, 10);
                ctx.rect(-10, -5, 80, 10);
                ctx.fill();
                ctx.stroke();

                ctx.beginPath();
                ctx.fillStyle = "#666666";
                ctx.rect(10, -15, 10, 30);
                ctx.rect(40, -15, 10, 30);
                ctx.fill();
                ctx.stroke();

                ctx.restore();

                return;
            }
            if (name == "Floor Cannon" || name == "Floor Cannon+") {
                var leg = 20 * Math.sqrt(2);

                if (!angle) ctx.rotate(-Math.PI/6);

                ctx.beginPath();
                ctx.fillStyle = "#999999";
                ctx.strokeStyle = "#000000";
                ctx.moveTo(0,-15);
                ctx.lineTo(50,-15);
                ctx.lineTo(50,-10);
                ctx.lineTo(90,-10);
                ctx.lineTo(90,10);
                ctx.lineTo(50,10);
                ctx.lineTo(50,15);
                ctx.lineTo(0,15);
                ctx.lineTo(-10,25);
                ctx.lineTo(-30,25);
                ctx.lineTo(-45,10);
                ctx.lineTo(-45,-10);
                ctx.lineTo(-30,-25);
                ctx.lineTo(-10,-25);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();

                ctx.beginPath();
                ctx.fillStyle = "#666666";
                ctx.moveTo(90,0);
                ctx.lineTo(90,10);
                ctx.lineTo(50,10);
                ctx.lineTo(50,15);
                ctx.lineTo(0,15);
                ctx.lineTo(0,5);
                ctx.lineTo(40,5);
                ctx.lineTo(40,0);
                ctx.closePath();
                ctx.fill();

                ctx.beginPath();
                ctx.strokeStyle = "#000000";
                ctx.moveTo(-15,-15);
                ctx.lineTo(-15,45);
                ctx.moveTo(5,35);
                ctx.lineTo(-35,-5);
                ctx.moveTo(5,-5);
                ctx.lineTo(-35,35);
                ctx.moveTo(15,15);
                ctx.lineTo(-45,15);
                ctx.arc(-15,15,30,0,Math.PI*2);
                //ctx.closePath();
                ctx.stroke();

                ctx.restore();

                return;
            }
            if (name == "Rod Railgun" || name == "Rod Railgun+") {
                if (!angle) ctx.rotate(-Math.PI/6);

                ctx.beginPath();
                ctx.fillStyle = "#22ccff";
                ctx.strokeStyle = "#000000";
                ctx.rect(0,-6,60,12);
                ctx.fill();
                ctx.stroke();

                ctx.beginPath();
                ctx.fillStyle = "#999999";
                ctx.strokeStyle = "#000000";
                ctx.moveTo(-30,-15);
                ctx.lineTo(-20,-20);
                ctx.lineTo(0,-15);
                ctx.lineTo(50,-15);
                ctx.lineTo(70,-4);
                ctx.lineTo(5,-4);
                ctx.lineTo(5,4);
                ctx.lineTo(70,4);
                ctx.lineTo(50,15);
                ctx.lineTo(0,15);
                ctx.lineTo(-20,20);
                ctx.lineTo(-30,15);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();

                ctx.beginPath();
                ctx.fillStyle = "#555555";
                ctx.strokeStyle = "#000000";
                ctx.rect(15,-20,10,40);
                ctx.rect(35,-20,10,40);
                ctx.fill();
                ctx.stroke();

                ctx.beginPath();
                ctx.fillStyle = "#2299bb";
                ctx.strokeStyle = "#000000";
                ctx.rect(-20,-10,20,20);
                ctx.fill();
                ctx.stroke();

                ctx.restore();

                return;
            }
            if (name == "Pistol Pistol" || name == "Pistol Pistol+") {
                ctx.beginPath();
                ctx.fillStyle = "#666666";
                ctx.rect(-15,0,20,30);
                ctx.rect(-20,-20,75,20);
                ctx.fill();
                ctx.stroke();
                ctx.beginPath();
                ctx.rect(-5,20,20,30);
                ctx.rect(-10,0,75,20);
                ctx.fill();
                ctx.stroke();

                ctx.restore();

                return;
            }
            if (name == "Gas Tank" || name == "Gas Tank+") {
                if (angle) ctx.rotate(Math.PI/4)
                else ctx.rotate(-Math.PI/6);

                ctx.beginPath();
                ctx.fillStyle = "#e00000";
                ctx.moveTo(-25,-20);
                ctx.lineTo(-20,-25);
                ctx.lineTo(5,-25);
                ctx.lineTo(25,-5);
                ctx.lineTo(25,50);
                ctx.lineTo(20,55);
                ctx.lineTo(-20,55);
                ctx.lineTo(-25,50);
                ctx.closePath();
                ctx.moveTo(10,15);
                ctx.arc(0,15,10,0,Math.PI*2, true);
                ctx.fill();
                ctx.stroke();

                ctx.beginPath();
                ctx.fillStyle = "#202020";
                ctx.moveTo(10,-20);
                ctx.lineTo(20,-10);
                ctx.lineTo(25,-15);
                ctx.lineTo(15,-25);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();

                ctx.restore();

                return;
            }
            if (name == "War Comb" || name == "War Comb+") {
                if (!angle) ctx.rotate(-Math.PI/6);

                ctx.beginPath();
                ctx.fillStyle = "#58f";
                ctx.arc(50, 0, 60, -Math.PI-Math.PI/4, -Math.PI+Math.PI/4);
                ctx.lineTo(50, -40);
                ctx.lineTo(50, -35);
                ctx.lineTo(10, -30);
                ctx.lineTo(10, -20);
                ctx.lineTo(40, -15);
                ctx.lineTo(40, -10);
                ctx.lineTo(5, -5);
                ctx.lineTo(5, 5);
                ctx.lineTo(40, 10);
                ctx.lineTo(40, 15);
                ctx.lineTo(10, 20);
                ctx.lineTo(10, 30);
                ctx.lineTo(50, 35);
                ctx.lineTo(50, 40);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();

                ctx.restore();

                return;
            }
            if (name == "Rubber Ball" || name == "Rubber Ball+") {
                if (!angle) ctx.rotate(-Math.PI/8);

                ctx.beginPath();
                ctx.strokeStyle = "#000";
                ctx.fillStyle = "#c0c";
                ctx.arc(0,0,30,0,Math.PI*2);
                ctx.fill();
                ctx.stroke();
                ctx.beginPath();
                ctx.arc(2,-2,25,0,Math.PI*2);
                ctx.fillStyle = "#d0d";
                ctx.fill();
                ctx.beginPath();
                ctx.arc(5,-5,20,0,Math.PI*2);
                ctx.fillStyle = "#e0e";
                ctx.fill();
                ctx.beginPath();
                ctx.arc(7,-7,10,0,Math.PI*2);
                ctx.fillStyle = "#f0f";
                ctx.fill();

                ctx.restore();

                return;
            }
            if (name == "Honed Katana" || name == "Honed Katana+") {
                ctx.rotate(-Math.PI/4);
                if (angle) ctx.translate(0, -100);

                ctx.beginPath();
                ctx.fillStyle = "#777";
                ctx.lineTo(-5,0);
                ctx.lineTo(-5,40);
                ctx.lineTo(5,40);
                ctx.lineTo(5,0);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();

                ctx.beginPath();
                ctx.fillStyle = "#333";
                ctx.moveTo(10,0);
                ctx.lineTo(10,-5);
                ctx.lineTo(-10,-5);
                ctx.lineTo(-10,0);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();

                ctx.beginPath();
                ctx.fillStyle = "#bbb";
                ctx.moveTo(-5,-5);
                ctx.lineTo(-5,-70);
                ctx.lineTo(5,-60);
                ctx.lineTo(5,-5);
                ctx.fill();
                ctx.stroke();

                ctx.restore();

                return;
            }
            if (name == "High Decibal" || name == "High Decibal+") {
                if (!angle) ctx.rotate(-Math.PI/6);

                ctx.beginPath();
                ctx.fillStyle = "#777";
                ctx.moveTo(-30,-30);
                ctx.lineTo(-30,30);
                ctx.lineTo(0,50);
                ctx.lineTo(30,30);
                ctx.lineTo(30,-30);
                ctx.lineTo(0,-10);
                ctx.lineTo(0,50);
                ctx.lineTo(0,-10);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();

                ctx.beginPath();
                ctx.fillStyle = "#aaa";
                ctx.moveTo(-30,-30);
                ctx.lineTo(0,-50);
                ctx.lineTo(30,-30);
                ctx.lineTo(0,-10);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();

                ctx.beginPath();
                ctx.fillStyle = "#333";
                ctx.moveTo(22,-15);
                ctx.lineTo(22,0);
                ctx.lineTo(8,10);
                ctx.lineTo(8,-5);
                ctx.closePath();
                ctx.moveTo(22,10);
                ctx.lineTo(22,25);
                ctx.lineTo(8,35);
                ctx.lineTo(8,20);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();

                /*ctx.beginPath();
                ctx.fillStyle = "#333";
                ctx.moveTo(10,0);
                ctx.lineTo(10,-5);
                ctx.lineTo(-10,-5);
                ctx.lineTo(-10,0);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();

                ctx.beginPath();
                ctx.fillStyle = "#bbb";
                ctx.moveTo(-5,-5);
                ctx.lineTo(-5,-70);
                ctx.lineTo(5,-60);
                ctx.lineTo(5,-5);
                ctx.fill();
                ctx.stroke();
*/
                ctx.restore();

                return;
            }
            if (name == "base") {
                ctx.beginPath();
                ctx.fillStyle = "#666666";
                ctx.rect(-10,10,20,30);
                ctx.rect(-15,-10,75,20);
                ctx.fill();
                ctx.stroke();

                ctx.restore();

                return;
            }
            //     |----------------------------------------------|
            //     |                   Bullet Mods                |
            //     |----------------------------------------------|
            if (name == "Big Bomb" || name == "Big Bomb+") {
                ctx.beginPath();
                ctx.fillStyle = "#666666";
                ctx.strokeStyle = "#000000";
                ctx.arc(0,0,20,-Math.PI/2,Math.PI/2*3);
                ctx.fill();
                ctx.arc(-20,-20,20,0,-Math.PI/2, true);
                ctx.stroke();

                ctx.beginPath();
                ctx.fillStyle = "#ffff00";
                ctx.translate(-20,-40);
                for(var i = 0; i < Math.PI*2+1; i += Math.PI/4) {
                    ctx.lineTo(Math.sin(i)*5, Math.cos(i)*5);
                    ctx.lineTo(Math.sin(i+Math.PI/8)*10, Math.cos(i+Math.PI/8)*10);
                }
                //ctx.arc(-20,-40, 4,0,Math.PI*2);
                ctx.fill();
                ctx.stroke();

                ctx.restore();

                return;
            }
            if (name == "Barcode Scanner" || name == "Barcode Scanner+") {
                if (!angle) ctx.rotate(Math.PI/20);
                
                ctx.beginPath();
                ctx.fillStyle = "#999999";
                ctx.strokeStyle = "#000000";
                ctx.rect(0,0,15,50);
                ctx.fill();
                ctx.stroke();

                ctx.arc(0,-20,20,Math.PI/2,-Math.PI/2);
                ctx.lineTo(40,-40);
                ctx.lineTo(40,0);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();

                ctx.lineWidth += 6;
                ctx.beginPath();
                ctx.moveTo(50,-40);
                ctx.lineTo(70, -60);
                ctx.moveTo(50,-30);
                ctx.lineTo(80, -40);
                ctx.moveTo(50,-20);
                ctx.lineTo(80, -20);
                ctx.moveTo(50,-10);
                ctx.lineTo(80, 0);
                ctx.moveTo(50, 0);
                ctx.lineTo(70, 20);
                ctx.stroke();

                ctx.lineWidth -= 6;

                ctx.strokeStyle = "#ffff99";
                ctx.stroke();

                ctx.restore();

                return;
            }
            if (name == "Shrapnel Shot" || name == "Shrapnel Shot+") {
                if (!angle) ctx.rotate(Math.PI/20);
                
                ctx.beginPath();
                ctx.fillStyle = "#555555";
                ctx.strokeStyle = "#000000";
                ctx.moveTo(0,0);
                ctx.lineTo(40,0);
                ctx.arc(0,0,40,0,Math.PI*1.25);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();
                
                ctx.beginPath();
                ctx.fillStyle = "#888888";
                ctx.strokeStyle = "#000000";
                ctx.moveTo(0,-10);
                ctx.lineTo(0,-50);
                ctx.arc(0,-10,40, Math.PI*1.5, Math.PI*1.25, true);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();
                
                ctx.beginPath();
                ctx.fillStyle = "#888888";
                ctx.strokeStyle = "#000000";
                ctx.moveTo(10,-10);
                ctx.lineTo(10,-10);
                ctx.arc(10,-10,40, 0, -Math.PI/4, true);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();
                
                ctx.beginPath();
                ctx.fillStyle = "#cccccc";
                ctx.strokeStyle = "#000000";
                ctx.moveTo(10,-20);
                ctx.lineTo(10,-60);
                ctx.arc(10,-20,40, Math.PI*1.5, -Math.PI/4);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();

                ctx.restore();

                return;
            }
            if (name == "Cobra Fang" || name == "Cobra Fang+") {
                if (!angle) ctx.rotate(Math.PI/20);
                
                ctx.beginPath();
                ctx.fillStyle = "#555555";
                ctx.strokeStyle = "#000000";
                ctx.arc(-50,0,50,-Math.PI/2,0);
                ctx.arc(-100,0,100,0,-Math.PI/4, true);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();
                
                ctx.beginPath();
                ctx.fillStyle = "#aaaaaa";
                ctx.strokeStyle = "#000000";
                ctx.arc(-50,0,50,-Math.PI/3,0);
                ctx.arc(-100,0,100,0,-Math.PI/6, true);
                ctx.fill();
                ctx.stroke();
                
                ctx.beginPath();
                ctx.fillStyle = "#00cc00";
                ctx.strokeStyle = "#000000";
                ctx.arc(-25,0,25,0,Math.PI/4);
                ctx.arc(0,33,15,-Math.PI/4*3,-Math.PI/4, true);
                ctx.arc(25,0,25,Math.PI/4*3,Math.PI);
                ctx.fill();
                ctx.stroke();

                ctx.restore();

                return;
            }
            if (name == "Heavy Gears" || name == "Heavy Gears+") {
                if (!angle) ctx.rotate(Math.PI/20);
                ctx.translate(-12,-12);
                for(var a = 0; a < 2; a++) {
                    ctx.beginPath();
                    ctx.fillStyle = "#888888";
                    ctx.strokeStyle = "#000000";
                    for(var i = 0; i < Math.PI*2+1; i += Math.PI/4) {
                        ctx.lineTo(Math.sin(i)*25, Math.cos(i)*25);
                        ctx.lineTo(Math.sin(i+Math.PI/12)*35, Math.cos(i+Math.PI/12)*35);
                        ctx.lineTo(Math.sin(i+Math.PI/6)*35, Math.cos(i+Math.PI/6)*35);
                    }
                    ctx.moveTo(15, 0);
                    ctx.arc(0,0,15,0,Math.PI*2);
                    ctx.fill();
                    ctx.stroke();

                    ctx.translate(24,24);
                    ctx.rotate(Math.PI/14);
                }

                ctx.restore();

                return;
            }
            if (name == "Lottery Card" || name == "Lottery Card+") {
                if (!angle) ctx.rotate(-Math.PI/20);
                ctx.beginPath();
                ctx.fillStyle = "#999";
                ctx.strokeStyle = "#000000";
                ctx.rect(-50,-30,100,60)
                ctx.fill();
                ctx.stroke();
                
                ctx.beginPath();
                ctx.fillStyle = "#ccc";
                ctx.arc(-30,10,13,0,Math.PI*2);
                ctx.arc(0,10,13,0,Math.PI*2);
                ctx.arc(30,10,13,0,Math.PI*2);
                ctx.fill();
                
                ctx.beginPath();
                ctx.fillStyle = "#ddd";
                ctx.font = "23px share tech";
                ctx.fillText("You Win", 0, -10)

                ctx.restore();

                return;
            }
            if (name == "Big Boi" || name == "Big Boi+") {
                if (!angle) ctx.rotate(-Math.PI/20);
                ctx.beginPath();
                ctx.fillStyle = "#444";
                ctx.strokeStyle = "#000000";
                ctx.rect(-50,-25,20,50)
                ctx.fill();
                ctx.stroke();
                
                ctx.beginPath();
                ctx.fillStyle = "#070";
                ctx.moveTo(-30,-10);
                ctx.lineTo(-10,-20);
                ctx.lineTo(10,-25);
                ctx.lineTo(30,-25);
                ctx.lineTo(50,-15);
                ctx.lineTo(55,0);
                ctx.lineTo(50,15);
                ctx.lineTo(30,25);
                ctx.lineTo(10,25);
                ctx.lineTo(-10,20);
                ctx.lineTo(-30,10);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();

                ctx.restore();

                return;
            }
            //     |----------------------------------------------|
            //     |                   Upgrades                   |
            //     |----------------------------------------------|
            if (name == "Cell Splitter" || name == "Cell Splitter+") {
                var leg = 20 * Math.sqrt(2);
                if (!angle) ctx.rotate(-Math.PI/6);

                ctx.beginPath();
                ctx.fillStyle = "#9999cc";
                ctx.strokeStyle = "#000000";
                ctx.arc(-leg,0,20,Math.PI/4,-Math.PI/4);
                ctx.arc(0,-leg,20,Math.PI/4*3,Math.PI/4, true);
                ctx.arc(leg,0,20,Math.PI/4*5,Math.PI/4*3);
                ctx.arc(0,leg,20,-Math.PI/4,-Math.PI/4*3, true);
                ctx.fill();
                ctx.stroke();

                ctx.beginPath();
                ctx.fillStyle = "#cccc99";
                ctx.arc(-leg,0,40-leg,Math.PI/6,-Math.PI/6);
                ctx.arc(0,-leg,leg,Math.PI/4*3,Math.PI/4, true);
                ctx.arc(leg,0,40-leg,Math.PI/6*7,Math.PI/6*5);
                ctx.arc(0,leg,leg,-Math.PI/4,-Math.PI/4*3, true);
                ctx.fill();

                ctx.restore();

                return;
            }
            if (name == "Metal Coil" || name == "Metal Coil+") {
                if (!angle) ctx.rotate(-Math.PI/8);

                ctx.beginPath();
                ctx.strokeStyle = "#000000";
                ctx.lineWidth += 6;

                ctx.arc(-50, 0, 20, 0, Math.PI/2, true)
                ctx.moveTo(-30, 0);
                ctx.lineTo(-25,20);
                ctx.moveTo(-15,-20);
                ctx.lineTo(-5,20);
                ctx.moveTo(5,-20);
                ctx.lineTo(15,20);
                ctx.moveTo(25,-20);
                ctx.lineTo(30, 0);
                ctx.arc(50, 0, 20, Math.PI, Math.PI/2*3, true)

                ctx.moveTo(-25,+20);
                ctx.lineTo(-15,-20);
                ctx.moveTo(-5,+20);
                ctx.lineTo(5,-20);
                ctx.moveTo(15,+20);
                ctx.lineTo(25,-20);
                ctx.stroke();

                ctx.strokeStyle = "#666666";
                ctx.lineWidth -= 6;
                ctx.beginPath();
                ctx.moveTo(-25,+20);
                ctx.lineTo(-15,-20);
                ctx.moveTo(-5,+20);
                ctx.lineTo(5,-20);
                ctx.moveTo(15,+20);
                ctx.lineTo(25,-20);
                ctx.stroke();

                ctx.strokeStyle = "#999999";
                ctx.beginPath();
                ctx.arc(-50, 0, 20, 0, Math.PI/2, true)
                ctx.moveTo(-30, 0);
                ctx.lineTo(-25,20);
                ctx.moveTo(-15,-20);
                ctx.lineTo(-5,20);
                ctx.moveTo(5,-20);
                ctx.lineTo(15,20);
                ctx.moveTo(25,-20);
                ctx.lineTo(30, 0);
                ctx.arc(50, 0, 20, Math.PI, Math.PI/2*3, true)
                ctx.stroke();

                ctx.restore();

                return;
            }
            if (name == "Bloody Scythe" || name == "Bloody Scythe+") {
                var leg = 20 * Math.sqrt(2);
                if (!angle) ctx.rotate(-Math.PI/8);

                ctx.beginPath();
                ctx.fillStyle = "#666666";
                ctx.strokeStyle = "#000000";
                ctx.rect(-40, -40, 10, 100);
                ctx.fill();
                ctx.stroke();

                ctx.beginPath();
                ctx.fillStyle = "#aaaaaa";
                ctx.arc(-40, 260, 300, -Math.PI/2, Math.PI/12-Math.PI/2);
                ctx.arc(-30, 270, 300, Math.PI/12-Math.PI/2, -Math.PI/2, true);
                ctx.fill();
                ctx.stroke();
                    // ( 77.64571353075623 , 289.7777478867205 )
                ctx.beginPath();
                ctx.fillStyle = "#990000";
                ctx.arc(47.65-20, -19.78, 20, 0, Math.PI/4);
                ctx.arc(47.65, -19.78+35, 20, -Math.PI/4*3, -Math.PI/4, true);
                ctx.arc(47.65+20, -19.78, 20, Math.PI/4*3, Math.PI);
                ctx.fill();
                ctx.stroke();
                
                ctx.restore();

                return;
            }
            if (name == "After Images" || name == "After Images+") {
                if (!angle) ctx.rotate(-Math.PI/8);

                ctx.beginPath();
                ctx.fillStyle = "#6699ff44";
                ctx.strokeStyle = "#00000044";
                ctx.arc(-40, 0, 30, 0, Math.PI*2);
                ctx.fill();
                ctx.stroke();

                ctx.beginPath();
                ctx.fillStyle = "#6699ffaa";
                ctx.strokeStyle = "#000000aa";
                ctx.arc(0, 0, 30, 0, Math.PI*2);
                ctx.fill();
                ctx.stroke();

                ctx.beginPath();
                ctx.fillStyle = "#6699ff";
                ctx.strokeStyle = "#000000";
                ctx.arc(40, 0, 30, 0, Math.PI*2);
                ctx.fill();
                ctx.stroke();
                
                ctx.restore();

                return;
            }
            if (name == "Health Tracker" || name == "Health Tracker+") {

                ctx.beginPath();
                ctx.fillStyle = "#ffffff";
                ctx.strokeStyle = "#000000";
                ctx.arc(-30, -30, 10, Math.PI, -Math.PI/2);
                ctx.arc(30, -30, 10, -Math.PI/2, 0);
                ctx.arc(30, 30, 10, 0, Math.PI/2);
                ctx.arc(-30, 30, 10, Math.PI/2, Math.PI);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();

                ctx.beginPath();
                ctx.fillStyle = "#aa3333";
                ctx.strokeStyle = "#000000";
                ctx.arc(-15, -10, 15, Math.PI, 0);
                ctx.arc(15, -10, 15, Math.PI, 0);
                ctx.lineTo(0,30);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();
                
                ctx.restore();

                return;
            }
            if (name == "Smooth Barrel" || name == "Smooth Barrel+") {
                if (!angle) ctx.rotate(-Math.PI/8);

                for(var a = 0; a < 2; a++) {
                    ctx.beginPath();
                    ctx.fillStyle = "#999999";
                    ctx.strokeStyle = "#000000";
                    ctx.moveTo(-40,-10);
                    ctx.lineTo(40,-10);
                    ctx.arc(40,0,10,-Math.PI/2,Math.PI/2);
                    ctx.lineTo(-40,10);
                    ctx.fill();
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.fillStyle = "#222222";
                    ctx.strokeStyle = "#000000";
                    ctx.arc(-40,0,10,0,Math.PI*2);
                    ctx.fill();
                    ctx.stroke();
                    
                    ctx.translate(20,10);
                }

                ctx.restore();

                return;
            }
            if (name == "Piercing Rounds" || name == "Piercing Rounds+") {
                if (!angle) ctx.rotate(-Math.PI/8);

                ctx.beginPath();
                ctx.fillStyle = "#999999";
                ctx.strokeStyle = "#000000";
                ctx.moveTo(-45,-20);
                ctx.lineTo(-35,-20);
                ctx.lineTo(-35,-15);
                ctx.lineTo(-25,-15);
                ctx.lineTo(-25,-20);
                ctx.arc(10,40, 60, -Math.PI/2, -Math.PI/4);
                ctx.arc(10,-40, 60, Math.PI/4, Math.PI/2);
                ctx.lineTo(-25,20);
                ctx.lineTo(-25,15);
                ctx.lineTo(-35,15);
                ctx.lineTo(-35,20);
                ctx.lineTo(-45,20);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();

                ctx.beginPath();
                ctx.fillStyle = "#33aa33";
                ctx.rect(-5,-20, 10, 40);
                ctx.fill();
                ctx.stroke();
                
                ctx.beginPath();
                ctx.fillStyle = "#ffffff55";
                ctx.moveTo(-45,-10);
                ctx.lineTo(-45,-20);
                ctx.lineTo(-35,-20);
                ctx.lineTo(-35,-15);
                ctx.lineTo(-25,-15);
                ctx.lineTo(-25,-20);
                ctx.arc(10,40, 60, -Math.PI/2, -Math.PI/32*9);
                ctx.closePath();
                ctx.fill();

                ctx.beginPath();
                ctx.fillStyle = "#00000055";
                ctx.arc(10,-40, 60, Math.PI/32*9, Math.PI/2);
                ctx.lineTo(-25,20);
                ctx.lineTo(-25,15);
                ctx.lineTo(-35,15);
                ctx.lineTo(-35,20);
                ctx.lineTo(-45,20);
                ctx.lineTo(-45,10);
                ctx.closePath();
                ctx.fill();

                ctx.restore();

                return;
            }
            //     |----------------------------------------------|
            //     |                   Singletons                 |
            //     |----------------------------------------------|
            if (name == "Big Cheese") {
                if (!angle) ctx.rotate(-Math.PI/16);

                ctx.beginPath();
                ctx.fillStyle = "#dddd00";
                ctx.strokeStyle = "#000000";
                ctx.rect(-50,-50,100,100);
                ctx.moveTo(10,-10);
                ctx.arc(-10,-10,20,0,Math.PI*2, true);
                ctx.moveTo(-20,30);
                ctx.arc(-30,30,10,0,Math.PI*2, true);
                ctx.moveTo(45,-20);
                ctx.arc(30,-20,15,0,Math.PI*2, true);
                ctx.moveTo(35,30);
                ctx.arc(20,30,15,0,Math.PI*2, true);
                ctx.fill();
                ctx.stroke();

                ctx.restore();

                return;
            }
            if (name == "Tight Boots") {
                if (!angle) ctx.rotate(-Math.PI/16);

                for (var a = 0; a < 2; a++) {
                    ctx.beginPath();
                    ctx.fillStyle = "#999999";
                    ctx.strokeStyle = "#000000";
                    ctx.rect(-30,-40,50,10);
                    ctx.fill();
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.fillStyle = "#2277cc";
                    ctx.moveTo(-25,30);
                    ctx.lineTo(-25,-30);
                    ctx.lineTo(10,-30);
                    ctx.lineTo(10,0);
                    ctx.fill();
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.fillStyle = "#2255aa";
                    ctx.moveTo(10,0);
                    ctx.arc(30,20,20,-Math.PI/2,0);
                    ctx.arc(40,20,10,0,Math.PI/2);
                    ctx.lineTo(-25,30);
                    ctx.fill();
                    ctx.stroke();
                    ctx.translate(-20,10);
                }

                ctx.restore();

                return;
            }
            if (name == "Energy Drink") {
                if (!angle) ctx.rotate(-Math.PI/16 + Math.PI/2);
                    ctx.beginPath();
                    ctx.fillStyle = "#55ddff";
                    ctx.strokeStyle = "#000000";
                    ctx.moveTo(-25,-20);
                    ctx.arc(25,0,20,-Math.PI/2,Math.PI/2);
                    ctx.lineTo(-25,20);
                    ctx.fill();
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.fillStyle = "#5599aa";
                    ctx.arc(-25,0,20,0,Math.PI*2);
                    ctx.fill();
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.lineWidth += 2;
                    ctx.strokeStyle = "#ffffff";
                    ctx.moveTo(5,0);
                    ctx.lineTo(15,3);
                    ctx.lineTo(15,-3);
                    ctx.lineTo(25,0);
                    ctx.stroke();
                    ctx.lineWidth -= 2;
                    ctx.strokeStyle = "#000000";

                ctx.restore();

                return;
            }
            if (name == "Healing Sign") {
                if (!angle) ctx.rotate(-Math.PI/16 + Math.PI/2);

                    draw("healthPickup", [{x: 0, y: 0, size: 10}]);

                ctx.restore();

                return;
            }

            ctx.beginPath();
            ctx.fillStyle = "#000000";
            ctx.fillRect(-25, -25, 50, 50);

            ctx.restore();
        }
        
        //   ||===========================================||
        //   ||               S T A R T U P               ||
        //   ||===========================================||
        
        if (true) tickLoop();
        else {
            // 0: upgrades, 1: bullets, 2: enemys
            const show = 0;
            if (show == 0) {
                upgradeImage(100,100,0,"Gatling Gun", 0, false, 1);
                upgradeImage(250,100,0,"Floor Cannon", 0, false, 1);
                upgradeImage(400,100,0,"Rod Railgun", 0, false, 1);
                upgradeImage(550,100,0,"Pistol Pistol", 0, false, 1);
                upgradeImage(700,100,0,"Gas Tank", 0, false, 1);
                upgradeImage(850,100,0,"War Comb", 0, false, 1);
                upgradeImage(1000,100,0,"Rubber Ball", 0, false, 1);
                upgradeImage(1150,100,0,"Honed Katana", 0, false, 1);
                upgradeImage(1300,100,0,"High Decibal", 0, false, 1);

                upgradeImage(100,400,0,"Big Bomb", 0, false, 1);
                upgradeImage(250,400,0,"Barcode Scanner", 0, false, 1);
                upgradeImage(400,400,0,"Shrapnel Shot", 0, false, 1);
                upgradeImage(550,400,0,"Cobra Fang", 0, false, 1);
                upgradeImage(700,400,0,"Heavy Gears", 0, false, 1);
                upgradeImage(850,400,0,"Lottery Card", 0, false, 1);
                upgradeImage(1000,400,0,"Big Boi", 0, false, 1);

                upgradeImage(100,700,0,"Cell Splitter", 0, false, 1);
                upgradeImage(250,700,0,"Metal Coil", 0, false, 1);
                upgradeImage(400,700,0,"Bloody Scythe", 0, false, 1);
                upgradeImage(550,700,0,"After Images", 0, false, 1);
                upgradeImage(700,700,0,"Health Tracker", 0, false, 1);
                upgradeImage(850,700,0,"Smooth Barrel", 0, false, 1);
                upgradeImage(1000,700,0,"Piercing Rounds", 0, false, 1);

                upgradeImage(100,800,0,"Big Cheese", 0, false, 1);
                upgradeImage(250,800,0,"Tight Boots", 0, false, 1);
                upgradeImage(400,800,0,"Energy Drink", 0, false, 1);
                upgradeImage(550,800,0,"Healing Sign", 0, false, 1);
            } else if (show == 1) {
                ctx.translate(100,100);
                bulletImage({type: "Honed Katana", size: 150, dir: 0}, 0);
            } else if (show == 2) {
                ctx.translate(100,100);
                enemyImage({type: "def", size: 20, dir: 0}, 0);
                ctx.translate(150, 0);
                enemyImage({type: "bigSword", size: 55, dir: 0}, 0);
                ctx.translate(-350, 0);
                enemyImage({type: "shooter", size: 20, dir: 0}, 0);
            }
        }
    </script>
</body>